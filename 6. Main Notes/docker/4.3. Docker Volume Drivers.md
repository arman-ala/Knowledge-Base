# Understanding Docker Volume Drivers

When working with Docker volumes, the concept of a "volume driver" is central to how volumes are managed and where their data is stored. We’ll explore what a volume driver is, the types of drivers available, and dive into specifics like the NFS driver. We’ll also clarify what it means to have a "non-local" (or unlocal) driver and provide a detailed table with explanations of various volume drivers, their use cases, and examples.

## What is a Volume Driver?

A volume driver in Docker is a plugin or mechanism that determines how a volume’s data is stored, accessed, and managed. When we create a volume, Docker uses a volume driver to handle the underlying storage operations, such as where the data is physically stored, how it’s mounted into containers, and any additional features like replication or encryption. The volume driver acts as an abstraction layer between Docker and the storage backend, allowing Docker to support a wide range of storage solutions—from local disk storage to remote cloud providers.

By default, Docker uses the `local` volume driver, which stores volume data on the host’s filesystem (typically in `/var/lib/docker/volumes/`). However, we can specify alternative drivers to store data elsewhere, such as on a network filesystem, a cloud provider, or a distributed storage system.

## Types of Volume Drivers

Docker supports two main categories of volume drivers:

1. **Built-in Drivers**:
   - Docker ships with a few built-in drivers, the most common being the `local` driver. These drivers are part of the Docker engine and don’t require additional setup beyond Docker itself.

2. **Third-Party Drivers (Plugins)**:
   - Docker allows third-party storage providers to create volume driver plugins, which extend Docker’s functionality to integrate with external storage systems like cloud providers (e.g., AWS EBS, Azure Blob Storage) or distributed filesystems (e.g., GlusterFS, Ceph). These plugins are installed separately and registered with Docker to handle volume operations.

There are dozens of third-party volume driver plugins available, and the exact number depends on the ecosystem and community contributions. Some are maintained by storage vendors (e.g., NetApp, Dell EMC), while others are open-source projects. We’ll cover a selection of the most common ones in the table below.

## What is the NFS Driver?

The NFS (Network File System) driver is a specific configuration of the `local` driver that allows Docker to mount a volume from a remote NFS server. NFS is a protocol that enables file sharing over a network, commonly used in environments where multiple machines need access to the same files. When we use the NFS driver, the volume’s data is stored on a remote NFS server rather than the Docker host’s local filesystem. The `local` driver facilitates this by supporting NFS as a "type" through its `--opt` options.

For example, we can create a volume that uses an NFS server as its backend:

```bash
docker volume create --driver local --opt type=nfs --opt o=addr=192.168.1.100,rw --opt device=:/nfs/share my-nfs-vol
```

Here, the volume `my-nfs-vol` is stored on an NFS server at `192.168.1.100`, and the data resides in the `/nfs/share` directory on that server. The `o=addr=192.168.1.100,rw` option specifies the NFS server address and mount options (e.g., read-write access).

## Can We Have a Non-Local (Unlocal) Driver?

Yes, we can use non-local drivers! The term "unlocal" isn’t standard, but it likely refers to drivers that store data outside the Docker host’s local filesystem—essentially, any driver other than the default `local` driver. Non-local drivers store data on external systems, such as network filesystems (e.g., NFS), distributed storage systems (e.g., Ceph, GlusterFS), or cloud storage (e.g., AWS EBS, Google Cloud Persistent Disk). These drivers are typically implemented as third-party plugins, though the `local` driver can also be configured for non-local storage (like NFS) using specific options.

Non-local drivers are useful in scenarios where:
- We need to share data across multiple Docker hosts (e.g., in a cluster).
- We want to leverage cloud storage for scalability and durability.
- We’re running a distributed application that requires centralized storage.

## Table of Volume Drivers with Full Explanations

Below is a detailed table of common Docker volume drivers, including the default `local` driver, the NFS configuration, and several third-party drivers. Each entry includes a description, use case, whether it’s local or non-local, and an example command to create a volume using that driver.

| **Driver**            | **Description**                                                                 | **Local/Non-Local** | **Use Case**                                                                 | **Example Command**                                                                 |
|-----------------------|---------------------------------------------------------------------------------|--------------------|------------------------------------------------------------------------------|-------------------------------------------------------------------------------------|
| `local`               | The default driver that stores volume data on the Docker host’s filesystem (e.g., `/var/lib/docker/volumes/`). Supports additional types like NFS or tmpfs via options. | Local (unless configured for NFS) | Storing data on the host for single-node applications or development.        | `docker volume create --driver local myvol`                                         |
| `local (NFS)`         | A configuration of the `local` driver that mounts a volume from a remote NFS server. Data is stored on the NFS server, not the Docker host. | Non-Local          | Sharing data across multiple hosts via a network filesystem.                 | `docker volume create --driver local --opt type=nfs --opt o=addr=192.168.1.100,rw --opt device=:/nfs/share my-nfs-vol` |
| `local (tmpfs)`       | A configuration of the `local` driver that stores data in the host’s memory (RAM) as a tmpfs filesystem. Data is ephemeral and lost on host restart. | Local (in-memory)  | Temporary storage for sensitive data that shouldn’t persist (e.g., caching). | `docker volume create --driver local --opt type=tmpfs --opt device=tmpfs my-tmpfs-vol` |
| `flocker` (Deprecated)| A third-party driver for Flocker, a data orchestration tool for Docker. Manages volumes across a cluster. Deprecated as Flocker is no longer maintained. | Non-Local          | Managing stateful applications in a cluster (historical use).               | (Not recommended due to deprecation)                                                |
| `glusterfs`           | A third-party driver for GlusterFS, a distributed filesystem. Stores data across multiple nodes for high availability and scalability. | Non-Local          | Distributed applications needing scalable, shared storage across nodes.     | `docker volume create --driver glusterfs --opt volname=myvol my-gluster-vol` (requires plugin installation) |
| `ceph` (via RBD)      | A third-party driver for Ceph, a distributed storage system. Uses Ceph’s RBD (RADOS Block Device) to provide block storage for volumes. | Non-Local          | High-performance storage for stateful applications in a cluster.            | `docker volume create --driver ceph --opt mon_host=192.168.1.100 my-ceph-vol` (requires plugin installation) |
| `aws-ebs` (via plugin)| A third-party driver for AWS Elastic Block Store (EBS). Stores volume data on EBS volumes in the AWS cloud. | Non-Local          | Running Docker in AWS with persistent, scalable block storage.              | `docker volume create --driver rexray/ebs my-ebs-vol` (requires `rexray/ebs` plugin) |
| `gce-docker`          | A third-party driver for Google Cloud Persistent Disk. Stores volume data on GCP disks. | Non-Local          | Running Docker in Google Cloud with persistent storage.                     | `docker volume create --driver gce-docker my-gce-vol` (requires plugin installation) |
| `azure-file`          | A third-party driver for Azure File Storage. Stores volume data in Azure’s SMB-based file storage. | Non-Local          | Running Docker in Azure with shared file storage.                           | `docker volume create --driver azure_file my-azure-vol` (requires `azure_file` plugin) |
| `netapp` (Trident)    | A third-party driver by NetApp (Trident) for integrating with NetApp storage systems (e.g., ONTAP, SolidFire). | Non-Local          | Enterprise environments with NetApp storage for high-performance volumes.   | `docker volume create --driver netapp my-netapp-vol` (requires Trident plugin)      |
| `portworx`            | A third-party driver for Portworx, a storage solution for containerized applications. Provides features like replication and snapshots. | Non-Local          | Running stateful applications in a Kubernetes or Docker Swarm cluster.      | `docker volume create --driver pxd my-portworx-vol` (requires Portworx plugin)      |

### Notes on the Table
- **Local vs. Non-Local**:
  - Local drivers store data on the Docker host (e.g., `local` driver with default settings or `tmpfs`).
  - Non-local drivers store data externally, such as on a network filesystem (NFS, GlusterFS), a distributed storage system (Ceph, Portworx), or a cloud provider (AWS EBS, Azure File).
- **Plugin Installation**:
  - Third-party drivers like `glusterfs`, `ceph`, `aws-ebs`, etc., require installing the corresponding Docker volume plugin. For example, to use the `rexray/ebs` driver for AWS EBS, we first install the plugin:
```bash
docker plugin install rexray/ebs
```
  
  - Some plugins require additional configuration, such as credentials for cloud providers or network settings for distributed systems.
- **NFS Configuration**:
  - The `local` driver’s NFS configuration requires an NFS server to be set up and accessible. The `--opt o=addr=<ip>,rw` specifies the NFS server’s IP and mount options (e.g., `rw` for read-write).
- **Driver Availability**:
  - The exact list of available drivers depends on the Docker version and the plugins installed. We can list installed plugins with:
```bash
docker plugin ls
```

- **Performance and Scalability**:
  - Local drivers are generally faster for single-node setups but don’t scale across multiple hosts.
  - Non-local drivers like GlusterFS, Ceph, or cloud-based drivers are designed for distributed environments but may introduce latency due to network access.

## Additional Considerations
- **Choosing a Driver**: The choice of driver depends on our use case. For a single host, the `local` driver is sufficient. For a cluster, we might choose a distributed driver like `glusterfs` or `portworx`. For cloud environments, drivers like `aws-ebs` or `gce-docker` integrate seamlessly with the cloud provider’s storage.
- **Security**: Non-local drivers often require network access, so we must ensure proper authentication and encryption (e.g., using TLS for NFS or cloud provider credentials).
- **Backup and Recovery**: Non-local drivers often provide built-in features for snapshots and backups (e.g., Portworx, AWS EBS), while the `local` driver requires manual backup strategies.
