When using the `docker run` command to create a container, the `--mount` flag provides a flexible and verbose way to attach storage (such as volumes, bind mounts, or tmpfs mounts) to a container. Unlike the simpler `-v` or `--volume` flag, `--mount` uses key-value pairs to specify the mount configuration, offering greater control and clarity. Below, we’ll create a detailed table covering all possible arguments and options for `--mount`, explain their purposes, and provide examples. After that, we’ll analyze two provided commands to determine which one creates a bind mount.

## Table of Arguments and Options for `docker run --mount`

The `--mount` flag accepts a comma-separated list of key-value pairs that define the mount’s properties. Below is a comprehensive table of all possible arguments and options, including their descriptions, applicable mount types, default behaviors, and example usage.

| **Argument/Option**                  | **Description**                                                                                                                                                   | **Applies To**   | **Default Behavior (If Not Provided)**                                                         | **Example Usage**                                                                                       |
| ------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------- | ---------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------- |
| `type`                               | Specifies the type of mount. Possible values are `bind`, `volume`, or `tmpfs`.                                                                                    | All mounts       | No mount is created; container uses its own ephemeral filesystem.                              | `--mount type=volume,source=myvol,destination=/app`                                                     |
| `source` (or `src`)                  | The source of the mount. For `volume`, it’s the volume name; for `bind`, it’s the host path; for `tmpfs`, it’s ignored.                                           | `bind`, `volume` | For `volume`: Docker creates an anonymous volume. For `bind`: Required, will error if missing. | `--mount type=bind,source=/mnt,destination=/mnt`                                                        |
| `destination` (or `dst` or `target`) | The path inside the container where the mount is attached.                                                                                                        | All mounts       | Required; will error if missing.                                                               | `--mount type=volume,source=myvol,destination=/app`                                                     |
| `readonly`                           | Mounts the volume or bind mount as read-only. If set, the container cannot write to the mount.                                                                    | `bind`, `volume` | Mount is read-write by default.                                                                | `--mount type=volume,source=myvol,destination=/app,readonly`                                            |
| `volume-opt` (or `volume-options`)   | Specifies driver-specific options for the volume (e.g., for the `local` driver with NFS). Multiple options can be specified as `key=value`.                       | `volume`         | No additional options are applied; uses driver defaults.                                       | `--mount type=volume,source=myvol,destination=/app,volume-opt=type=nfs,volume-opt=o=addr=192.168.1.100` |
| `volume-driver`                      | Specifies the volume driver to use for the volume (e.g., `local`, `glusterfs`).                                                                                   | `volume`         | Uses the default `local` driver.                                                               | `--mount type=volume,source=myvol,destination=/app,volume-driver=local`                                 |
| `volume-nocopy`                      | Disables copying data from the container’s filesystem to the volume on first mount. Only applies if the destination path in the container has data.               | `volume`         | Data is copied from the container to the volume on first mount.                                | `--mount type=volume,source=myvol,destination=/app,volume-nocopy`                                       |
| `bind-propagation`                   | Sets the propagation mode for bind mounts (e.g., `rprivate`, `rshared`, `private`, `shared`). Controls how mounts are propagated to nested mounts.                | `bind`           | Default is `rprivate` (no propagation).                                                        | `--mount type=bind,source=/mnt,destination=/mnt,bind-propagation=shared`                                |
| `consistency`                        | Defines the consistency guarantee for the mount (e.g., `consistent`, `cached`, `delegated`). Primarily used on macOS with Docker Desktop to optimize performance. | `bind`, `volume` | Default is `consistent` (full consistency).                                                    | `--mount type=bind,source=/mnt,destination=/mnt,consistency=cached`                                     |
| `tmpfs-size`                         | Sets the size limit for a tmpfs mount (e.g., `100m` for 100 MB).                                                                                                  | `tmpfs`          | No size limit; limited by host memory.                                                         | `--mount type=tmpfs,destination=/tmp,tmpfs-size=100m`                                                   |
| `tmpfs-mode`                         | Sets the file mode (permissions) for the tmpfs mount (e.g., `0755`). Uses octal notation.                                                                         | `tmpfs`          | Default mode is `1777` (world-writable with sticky bit).                                       | `--mount type=tmpfs,destination=/tmp,tmpfs-mode=0755`                                                   |

### Examples
![[4.8_img-1.png]]

![[4.8_img-2.png]]
- We can write to volumes in **read only** containers.

### Notes on `--mount` Options
- **Required Fields**: The `type` and `destination` arguments are mandatory. Omitting them will result in an error.
- **Source Requirement**:
  - For `volume` mounts, if `source` is omitted, Docker creates an anonymous volume.
  - For `bind` mounts, `source` is required; omitting it will cause an error.
  - For `tmpfs` mounts, `source` is ignored since tmpfs mounts are in-memory and don’t have a source.
- **Bind Propagation**:
  - `rprivate`: No propagation (default).
  - `private`: No propagation, but applies to the mount itself.
  - `shared`: Propagates mounts to replicas (e.g., in a nested mount scenario).
  - `rshared`: Recursive shared propagation.
  - This is advanced and typically used in complex setups with nested containers or mounts.
- **Consistency (macOS-Specific)**:
  - `consistent`: Full consistency between host and container (slower).
  - `cached`: Host is authoritative; container sees a cached view (faster reads).
  - `delegated`: Container is authoritative; host sees a delegated view (faster writes).
  - This option is mostly relevant for Docker Desktop on macOS due to its filesystem virtualization layer.
- **Volume Options**: The `volume-opt` argument is driver-specific. For example, with the `local` driver, we can use `volume-opt=type=nfs` to mount an NFS share.

## Analyzing the Commands: Which One is a Bind Mount?

Let’s examine the two provided commands to determine which one creates a bind mount.

### Command 1: Using `-v`
```bash
docker run -it --name centos_custom -v /home:/SharedData centos:latest
```

- **Analysis**:
  - The `-v` (or `--volume`) flag is used in the format `host-path:container-path[:options]`.
  - Here, `/home` (on the host) is mapped to `/SharedData` (inside the container).
  - When `-v` specifies a host path as the source (like `/home`), it creates a **bind mount**. This means the host directory `/home` is directly mounted into the container at `/SharedData`, and any changes on either side are reflected in the other.
  - No options like `:ro` (read-only) are specified, so the mount is read-write by default.

### Command 2: Using `--mount`
```bash
docker run -it --name centos_bind --mount type=bind,source=/mnt,target=/mnt centos:latest
```

- **Analysis**:
  - The `--mount` flag explicitly specifies `type=bind`, indicating a bind mount.
  - The `source=/mnt` refers to the host directory `/mnt`, and `target=/mnt` specifies the container path where it’s mounted.
  - This is also a **bind mount**, as `type=bind` directly maps the host directory `/mnt` to the container’s `/mnt`. Like the first command, it’s read-write by default since `readonly` is not specified.

### Verdict: Both Commands Create Bind Mounts
- **Command 1** (`-v /home:/SharedData`): Creates a bind mount because the source (`/home`) is a host filesystem path.
- **Command 2** (`--mount type=bind,source=/mnt,target=/mnt`): Creates a bind mount because `type=bind` explicitly defines it as such.

### Key Difference Between the Commands
- **Syntax**: Command 1 uses the `-v` flag, which is a shorthand but less explicit. Command 2 uses `--mount`, which is more verbose and clearer about the intent (`type=bind`).
- **Paths**: Command 1 mounts `/home` to `/SharedData`, while Command 2 mounts `/mnt` to `/mnt`. The choice of paths doesn’t affect the fact that both are bind mounts.
- **Flexibility**: The `--mount` syntax in Command 2 allows for more options (e.g., `bind-propagation`, `consistency`), making it more flexible for advanced use cases.

## Additional Notes on Bind Mounts
- **Bind Mount Characteristics**:
  - Bind mounts directly map a host directory or file into the container.
  - They are not managed by Docker (unlike volumes), meaning the host path must exist before running the container.
  - Any process on the host can modify the source directory, which can lead to data consistency issues if not managed carefully.
- **Best Practices**:
  - Use bind mounts for development or scenarios where we need real-time access to host files (e.g., mounting a code directory for live reloading).
  - For production, prefer volumes for better isolation and management, as they are fully managed by Docker and less prone to external interference.

By understanding the `--mount` options and identifying bind mounts, we can make informed decisions about how to manage storage in our Docker containers.