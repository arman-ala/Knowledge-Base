# 5.9. Assign Static IP

2025-08-09 10:49
Status: #DONE
Tags: [[Docker]]

---

In Docker, assigning a static IP address to a container ensures consistent network configurations, which is critical for scenarios requiring predictable communication, such as clustered applications or specific network policies. Based on the provided information and common DevOps practices, we will explore how to create and manage Docker containers with static IP addresses. This includes creating a custom network, launching containers with assigned IPs, and managing network connections. We will also address any potential errors in the provided commands and provide a clear, structured guide.

## Understanding the Need for Static IPs in Docker

In some cases, we need our Docker containers to have fixed IP addresses to ensure reliable communication with other services or to adhere to specific network configurations. The provided text highlights two approaches: assigning a static IP during container creation or using the `docker network connect` command to attach a container to a network with a predefined IP. Below, we will detail both methods, ensuring clarity and correctness.

## Step 1: Creating a Custom Docker Network

To assign static IP addresses, we first need a custom network with a defined subnet. Docker’s default bridge network does not support static IP assignments, so we create a user-defined bridge network.

### Command to Create a Custom Network
```
docker network create --subnet=172.20.0.0/16 mynet
```

This command creates a network named `mynet` with a subnet of `172.20.0.0/16`. The subnet defines the range of IP addresses available (e.g., `172.20.0.1` to `172.20.255.254`). The `--subnet` flag is essential to allow manual IP assignments within this range.

### Verification
To confirm the network was created:
```
docker network ls
```
This lists all networks, and `mynet` should appear. To inspect its details:
```
docker network inspect mynet
```
This command provides information about the network, including its subnet and connected containers.

## Step 2: Running a Container with a Static IP

Once the network is created, we can launch a container with a static IP address. The provided text mentions running a detached CentOS container, which we will expand upon.

### Command to Run a Container
```
docker run --detach --name centos-container --network mynet --ip 172.20.0.10 centos:latest
```

- `--detach` (or `-d`): Runs the container in the background.
- `--name centos-container`: Assigns a name to the container for easy reference.
- `--network mynet`: Connects the container to the custom network.
- `--ip 172.20.0.10`: Assigns a static IP within the `mynet` subnet.
- `centos:latest`: Specifies the image to use (latest CentOS version).

### Notes
- Ensure the IP (e.g., `172.20.0.10`) is within the subnet (`172.20.0.0/16`) and not already in use.
- If the `centos:latest` image is unavailable, Docker will attempt to pull it from Docker Hub. Ensure internet access or use a locally available image.

## Step 3: Connecting an Existing Container to a Network

The provided text references using `docker network connect` to assign a static IP to an existing container. This is the second approach for static IP assignment.

### Command to Connect a Container
```
docker network connect --ip 172.20.0.11 mynet centos-container
```

- `--ip 172.20.0.11`: Assigns the specified IP to the container on the `mynet` network.
- `mynet`: The target network.
- `centos-container`: The name of the existing container.

### Important Considerations
- A container cannot have multiple IPs on the same network. If the container is already connected to `mynet`, running this command with a different IP will fail unless the container is first disconnected (see Step 5).
- This method is useful for containers initially launched without a static IP or on a different network.

## Step 4: Inspecting Network Configuration

To verify the container’s IP and network settings:
```
docker inspect centos-container
```
This command outputs detailed information, including the container’s network configuration. Look for the `Networks` section to confirm the assigned IP (e.g., `172.20.0.10` or `172.20.0.11`).

Alternatively, for network-specific details:
```
docker network inspect mynet
```
This shows all containers connected to `mynet` and their respective IPs.

## Step 5: Disconnecting a Container from a Network

If we need to reassign a different IP or move the container to another network, we must first disconnect it from the current network.

### Command to Disconnect
```
docker network disconnect mynet centos-container
```

This removes the container from `mynet`. We can then reconnect it with a new IP using the `docker network connect` command.

## Correcting Potential Mistakes

The provided text and commands are mostly accurate but lack specificity in some areas. Here are corrections and clarifications:
1. **Ambiguity in Commands**: The text mentions “custom static ip docker containers run it detached name centos latest” without a clear command structure. The corrected command is provided above (`docker run --detach --name ...`).
2. **Missing Subnet Specification**: The text references creating a network but omits the `--subnet` flag. Without it, Docker assigns a default subnet, which may conflict with other networks. Always specify `--subnet` for predictability.
3. **Incomplete `docker network connect` Usage**: The text mentions this command but does not clarify the need to disconnect a container first if reassigning an IP on the same network.

## Additional Best Practices

- **IP Management**: Maintain a record of assigned IPs to avoid conflicts within the subnet.
- **Network Isolation**: Use custom networks for different projects to isolate traffic and enhance security.
- **Container Naming**: Use meaningful names (e.g., `centos-container`) to simplify management.
- **Image Selection**: Ensure the `centos:latest` image suits your needs. For specific use cases, consider using a tagged version (e.g., `centos:7`) for consistency.


## Conclusion

Assigning static IP addresses to Docker containers enhances network reliability and simplifies service communication. By creating a custom network with a defined subnet, launching containers with specific IPs, or connecting existing containers to a network with assigned IPs, we can achieve precise control over our Docker environment. Commands like `docker network create`, `docker run`, `docker network connect`, `docker inspect`, and `docker network disconnect` are essential tools in this process. By following these steps and best practices, we ensure robust and maintainable Docker network configurations.

![[5.9. connection via network example.png]]

# Connecting to a MariaDB Docker Container and Managing Database Access

In this guide, we explore how to connect to a MariaDB database running inside a Docker container, leveraging its container name for network connectivity within a custom Docker network. The provided text and keywords suggest a focus on MariaDB, MySQL-compatible commands, container networking, and database management. We will address the specific question of whether it’s possible to connect to a container via its name, provide detailed explanations of relevant commands, and clarify any potential errors or ambiguities in the provided information. The process includes setting up a MariaDB container, connecting to it, and executing database commands, all within a Docker network context.

## Setting Up a MariaDB Container in a Docker Network

To enable connectivity between containers using their names, we need to create a custom Docker network and run the MariaDB container within it. The provided text indicates that we successfully connected from one container to a MariaDB container on the same network, which aligns with Docker’s networking capabilities.

### Step 1: Creating a Custom Docker Network
We start by creating a custom bridge network to allow containers to communicate using their names as hostnames.

```
docker network create mynet
```

This command creates a network named `mynet`. By default, Docker assigns a subnet, but we can specify one (e.g., `--subnet=172.20.0.0/16`) for more control, as discussed in the previous conversation.

### Step 2: Running a MariaDB Container
We launch a MariaDB container in detached mode, connected to the custom network, and configure it with a root password for secure access.

```
docker run --detach --name maria_db --network mynet -e MYSQL_ROOT_PASSWORD=123 mariadb:latest
```

- `--detach` (or `-d`): Runs the container in the background.
- `--name maria_db`: Assigns a name to the container, which other containers on the same network can use as a hostname.
- `--network mynet`: Connects the container to the `mynet` network.
- `-e MYSQL_ROOT_PASSWORD=my-secret-pw`: Sets the root password for MariaDB (replace `my-secret-pw` with a secure password).
- `mariadb:latest`: Uses the latest MariaDB image from Docker Hub.

This setup ensures the MariaDB container is accessible within the `mynet` network by its name, `maria_db`.

## Answering the Question: Connecting to a Container via Its Name

The provided text confirms that we connected to a MariaDB container from another container on the same network, implying the use of the container’s name for connectivity. **Yes, it is possible to connect to a container via its name** in Docker, provided both containers are on the same user-defined network. Docker’s built-in DNS resolution allows containers within the same network to resolve each other’s names as hostnames, eliminating the need to use IP addresses.

For example, if another container (e.g., a web application) is running on the `mynet` network, it can connect to the MariaDB container using `maria_db` as the hostname. This is a key advantage of user-defined networks over Docker’s default bridge network, where name-based resolution is not available.

### Example: Connecting from Another Container
Suppose we have a second container running a client application (e.g., a MySQL client or a web app). We launch it on the same network:

```
docker run --detach --name client-container --network mynet mysql:latest mysql -h maria_db -u root -p
```

- `-h maria_db`: Specifies the MariaDB container’s name as the hostname.
- `-u root`: Uses the MariaDB root user.
- `-p`: Prompts for the root password (set as `my-secret-pw` in the MariaDB container).

This command assumes the `mysql:latest` image, which includes the MySQL client compatible with MariaDB. The client container resolves `maria_db` to its IP address within `mynet` and establishes a connection.

## Step 3: Accessing the MariaDB Container Directly

To interact with the MariaDB database directly, we can execute commands inside the MariaDB container using `docker exec`.

```
docker exec -it maria_db mariadb -u root -p
```

- `-it`: Enables interactive mode with a terminal.
- `maria_db`: The name of the MariaDB container.
- `mariadb -u root -p`: Runs the MariaDB client, connecting as the root user and prompting for the password.

Upon entering the password (`my-secret-pw`), we access the MariaDB monitor, which displays a welcome message similar to:

```
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is X
Server version: X.X.X-MariaDB-1~focal mariadb.org binary distribution

Copyright (c) 2000, 2023, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.
```

This confirms a successful connection to the MariaDB server running in the container.
