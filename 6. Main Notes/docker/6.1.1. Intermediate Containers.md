# 6.1.1. Intermediate Containers


2025-08-09 10:49
Status: #DONE
Tags: [[Docker]]

---
# Understanding Intermediate Containers in Docker  

When working with Docker, we often hear about "containers" and "images," but another important concept is **intermediate containers**. These are temporary containers created during the image-building process, and understanding them helps optimize Docker workflows.  

## ELI5: What Are Intermediate Containers?  
Imagine you're baking a cake (this is your final Docker image). While preparing it, you mix ingredients in separate bowls (these are like intermediate containers). Once the cake is baked, you don’t need the mixing bowls anymore—they were just temporary helpers. Similarly, Docker creates intermediate containers to build layers of your final image, then discards them.  

## Technical Explanation  
When we run `docker build`, Docker executes each instruction in the `Dockerfile` step by step. For each instruction (like `RUN`, `COPY`, etc.), Docker:  
1. Creates a temporary container (intermediate container) to execute the command.  
2. Saves the changes as a new layer.  
3. Removes the temporary container if it’s no longer needed.  

### Example Scenario  
Let’s say we have this simple `Dockerfile`:  
```
FROM alpine  
RUN apk add curl  
COPY app.sh /app.sh  
```  
Here’s what happens behind the scenes:  
1. Docker starts with the base `alpine` image.  
2. It creates an intermediate container to run `apk add curl`, then saves this layer.  
3. Another intermediate container is created to copy `app.sh`, and this layer is also saved.  
4. Finally, the intermediate containers are removed, leaving only the final image.  

## Why Do Intermediate Containers Matter?  
- **Debugging**: If a build fails, we can inspect the last intermediate container to troubleshoot.  
- **Disk Space**: Too many intermediate containers (especially from failed builds) can consume space. Clean them with:  
```
docker system prune
```  
- **Layer Caching**: Docker reuses intermediate layers (if unchanged) to speed up builds.  

## Managing Intermediate Containers  
To list all containers (including intermediate ones):  
```
docker ps -a
```  
To remove unused intermediate containers and free space:  
```
docker container prune
```  

## Key Takeaways  
Intermediate containers are temporary helpers in the Docker build process. They don’t appear in the final image but play a crucial role in layer creation. Properly managing them ensures efficient builds and a clean system.  

![[6.1.1. Dockerfile Content.png]]

![[6.1.1. Docker_Layers.png]]  

The diagram above shows how each instruction in a `Dockerfile` creates a new layer, with intermediate containers facilitating the process. The final image is a stack of these immutable layers.