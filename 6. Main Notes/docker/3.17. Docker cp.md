# 3.17. Docker cp

2025-08-09 18:44
Status: #DONE 
Tags: [[Docker]]

---
## Using `docker cp` to Transfer Files with the `centos_attach` Container

Let’s walk through how to use the `docker cp` command to transfer files between your Docker host and the `centos_attach` container. We’ll also explore the available flags for `docker cp` in a table and discuss file ownership details, including the user and group IDs (UUID/GUID) you’ll see when listing files.

### Transferring Files with `docker cp`

The `docker cp` command allows you to copy files or directories between a container and the Docker host (or vice versa). Based on your `docker ps` output, you have a running container:

- **Container**: `centos_attach` (ID `36964d2e17c8`)
- **Image**: `centos:latest`
- **Command**: `"/bin/bash"`
- **Status**: `Up 3 hours`

Let’s assume you want to:
1. Copy a file from the Docker host to the `centos_attach` container.
2. Copy a file from the `centos_attach` container back to the Docker host.

#### Copying a File from the Docker Host to the Container
Suppose you have a file named `host_file.txt` on your Docker host, located at `/home/user/host_file.txt`. You want to copy it into the `/tmp` directory inside the `centos_attach` container.

**Command**:
```bash
docker cp /home/arman/host_file.txt centos_attach:/tmp/host_file.txt
```

**What Happens**:
- The file `host_file.txt` is copied from the host’s `/home/user/` directory to the container’s `/tmp` directory.
- Inside the container, you can verify the file’s presence by running:
```bash
docker exec centos_attach ls /tmp
```
  This lists `host_file.txt` among the files in `/tmp`:
  
![[3.17_img-1.png]]

#### Copying a File from the Container to the Docker Host
Now, let’s say there’s a file named `container_file.txt` inside the `centos_attach` container, located at `/root/container_file.txt`. You want to copy it to the Docker host at `/home/user/container_file.txt`.

**Command**:
```bash
docker cp centos_attach:/root/container_file.txt /home/user/container_file.txt
```

**What Happens**:
- The file `container_file.txt` is copied from the container’s `/root` directory to the host’s `/home/user/` directory.
- On the host, you can verify the file’s presence by running:
  ```bash
  ls /home/user
  ```
  This shows `container_file.txt` in the directory:

![[3.17_img-2.png]]

### Options for `docker cp`

The `docker cp` command supports a few flags to customize its behavior. Here’s a table explaining each option:

| Option                | Description                                                                                                                                                                                                                              |
| --------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `-a`, `--archive`     | Ensures the file’s metadata (like ownership and permissions) is preserved during the copy. Without this flag, the file’s ownership may change based on the target environment. Example: `docker cp -a host_file.txt centos_attach:/tmp`. |
| `-L`, `--follow-link` | Follows symbolic links in the source path and copies the target file instead of the link itself. If the source is a symlink, this ensures the actual file is copied. Example: `docker cp -L /home/user/symlink.txt centos_attach:/tmp`.  |
| `-q`, `--quiet`       | Suppresses progress output during the copy operation, making the command quieter. Useful for scripting. Example: `docker cp -q host_file.txt centos_attach:/tmp`.                                                                        |

**Example with Flags**:
To copy `host_file.txt` while preserving its metadata and suppressing output:

```bash
docker cp -a -q /home/user/host_file.txt centos_attach:/tmp/host_file.txt
```

### File Ownership After Using `docker cp`

When you transfer files between the Docker host and a container (or vice versa) using `docker cp`, the ownership of the file (user ID and group ID, or UUID/GUID) can change depending on the context. Let’s break this down for both directions and explain what you’ll see when you run `ls`.

#### Copying from Host to Container
- **On the Host**: Suppose `host_file.txt` on the Docker host (`/home/user/host_file.txt`) is owned by the user `user` with UID 1000 and group `user` with GID 1000. You can check this with:

```bash
ls -ln /home/user/host_file.txt
```

Output looks like:
```
-rw-r--r-- 1 1000 1000 1 Mar 29 05:56 host_file.txt
```

  Here, `1000 1000` represents the UID and GID.

- **After Copying to the Container**: When you copy this file to the `centos_attach` container using:

```bash
docker cp /home/user/host_file.txt centos_attach:/tmp/host_file.txt
```

  The file’s ownership inside the container depends on whether you used the `-a` flag:
  - **Without `-a`**: Docker copies the file’s contents but adjusts the ownership to match the container’s default user context. In the `centos_attach` container (based on `centos:latest`), the default user for most operations is `root` (UID 0, GID 0), because the container’s primary process (`/bin/bash`) runs as `root`. So, inside the container:

```bash
docker exec centos_attach ls -ln /tmp/host_file.txt
```

Output:
```
-rw-r--r-- 1 1000 1000 1 Mar 29 05:56 host_file.txt
```

The file is now owned by `root` (UID 0, GID 0) inside the container, regardless of its ownership on the host.
  - **With `-a`**: If you use the `--archive` flag:
```bash
docker cp -a /home/user/host_file.txt centos_attach:/tmp/host_file.txt
```

Docker preserves the original ownership (UID 1000, GID 1000). Inside the container:
```bash
docker exec centos_attach ls -ln /tmp/host_file.txt
```

Output:
```
-rw-r--r-- 1 1000 1000 1 Mar 29 05:56 host_file.txt
```

However, UID 1000 might not map to a user inside the container (since `centos:latest` typically only has the `root` user by default). If you run `docker exec centos_attach ls -l /tmp/host_file.txt` (without `-n`), the owner might appear as `1000` instead of a username, because there’s no user with UID 1000 in the container’s `/etc/passwd`.

#### Copying from Container to Host
- **In the Container**: Suppose `container_file.txt` in the `centos_attach` container (`/root/container_file.txt`) is owned by `root` (UID 0, GID 0), which is typical since the container runs as `root`. Inside the container:

```bash
docker exec centos_attach ls -ln /root/container_file.txt
```

Output:
```
-rw-r--r-- 1 1000 1000 0 Mar 29 09:30 container_file.txt
```

- **After Copying to the Host**: When you copy this file to the Docker host using:
```bash
docker cp centos_attach:/root/container_file.txt /home/user/container_file.txt
```

  The file’s ownership on the host depends on the `-a` flag:
  - **Without `-a`**: Docker copies the file’s contents but adjusts the ownership to match the user running the `docker` command on the host. If you’re running Docker as `user` (UID 1000, GID 1000), the file on the host will be owned by that user:
  
```bash
ls -ln /home/user/container_file.txt
```

Output:
```
-rw-r--r-- 1 1000 1000 0 Mar 29 09:30 container_file.txt
```

The file is now owned by `user` (UID 1000, GID 1000) on the host.
  - **With `-a`**: If you use the `--archive` flag:
```bash
docker cp -a centos_attach:/root/container_file.txt /home/user/container_file.txt
```

Docker preserves the original ownership (UID 0, GID 0). On the host:
```bash
ls -ln /home/user/container_file.txt
```

Output:
```
-rw-r--r-- 1 0 0 456 Mar 28 10:00 container_file.txt
```

The file is owned by `root` (UID 0, GID 0) on the host, which might require `sudo` to access or modify, depending on your user’s permissions.

#### Additional Insight: User Mapping and Namespaces
- **User Namespaces**: If your Docker setup uses user namespaces (a security feature to map container UIDs to host UIDs), the UID/GID you see might be remapped. For example, a container UID 0 (`root`) might map to a non-root UID on the host (e.g., 100000). In your case, since you’re running on `arm64` (as indicated by `arman-ala@Docker`), user namespaces might not be enabled by default, so UID 0 in the container maps directly to UID 0 (`root`) on the host.
- **Practical Tip**: If you need specific ownership, use the `-a` flag to preserve metadata, or adjust ownership after copying with `chown`. For example, after copying to the host:
  ```bash
  sudo chown user:user /home/user/container_file.txt
  ```

### Key Takeaways
- Use `docker cp` to easily transfer files between the host and container, specifying the source and destination paths.
- The `-a` flag is crucial if you want to preserve file ownership and permissions during the copy.
- Without `-a`, files copied to the container are owned by the container’s default user (usually `root`), and files copied to the host are owned by the user running the `docker` command.
- Be mindful of UID/GID mapping, especially if user namespaces are enabled, as this can affect how ownership appears on the host.