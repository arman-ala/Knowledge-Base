# Partitioning Example

2025-10-12 10:14
Status: #DONE 
Tags: [[Linux]]

---
# Practical Guide to Partition Creation, Formatting, and Mounting

## Step-by-Step Process Analysis

### Phase 1: Extended and Logical Partition Creation

![[2.8. fdisk.png]]

**Partitioning with fdisk:**
```bash
# Creating Extended Partition
Command: n → e → Partition 4 → +500M
Result: Extended partition (container) of 500MB created

# Creating Logical Partition within Extended
Command: n → l → +200M
Result: Logical partition /dev/sdb5 of 200MB created
```

**Key Observations:**
- **Extended Partition (sda4)**: Acts as container (500MB)
- **Logical Partition (sdb5)**: Usable storage space (200MB)
- **Signature Warning**: System detected previous filesystem signature
- **Signature Removal**: Necessary for clean filesystem creation

### Phase 2: Filesystem Creation

![[2.8. mkfs.png]]

**Formatting with mkfs:**
```bash
sudo mkfs -t ext3 /dev/sdb5
```

**Filesystem Creation Details:**
- **Blocks**: 51,200 blocks of 4KB each (total ~200MB)
- **Inodes**: 51,200 inodes allocated
- **Journal**: 4096 blocks (ext3 journaling feature)
- **UUID**: Automatic unique identifier generation
- **Superblock Backups**: Stored at block 32768 for recovery

### Phase 3: Mounting and Verification

![[2.8. mount.png]]

**Mounting the Filesystem:**
```bash
sudo mount -t ext3 /dev/sdb5 /mnt/flash
```

**Verification with df -h:**
```
/dev/sdb5    172M  44K  162M   1% /mnt/flash
```

**Capacity Analysis:**
- **Total**: 172M (slightly less than 200MB due to filesystem overhead)
- **Used**: 44K (initial filesystem structures)
- **Available**: 162M (free space for user data)
- **Usage**: 1% (minimal initial usage)

![[2.8. diagram 1.png]]

![[2.8. df.png]]

## Technical Deep Dive

### Filesystem Overhead Calculation

**Why 200MB ≠ 172MB available:**
- **Journal**: 4096 blocks × 4KB = 16MB
- **Superblocks**: Primary + backup copies
- **Inode tables**: Space for 51,200 inodes
- **Group descriptors**: Filesystem metadata
- **Reserved blocks**: Typically 5% for root

### Automatic Directory Creation

**lost+found Directory:**
- **Purpose**: System recovery directory for `fsck`
- **Location**: Root of every ext2/ext3/ext4 filesystem
- **Function**: Stores recovered files after filesystem check
- **Creation**: Automatic during `mkfs` operation
- **Permissions**: Owned by root, accessible to system

## Practical Implications

### Storage Efficiency

**Effective vs. Theoretical Capacity:**
```
Theoretical: 200MB
- Journal: 16MB
- Metadata: ~12MB
Available: 172MB (86% efficiency)
```

### Filesystem Characteristics

**ext3 Features Demonstrated:**
- **Journaling**: 4096-block journal for crash recovery
- **Block Size**: 4KB standard for balance performance
- **Inode Ratio**: 1 inode per 4KB (balanced for general use)
- **UUID**: Unique identification for reliable mounting

### Mount Point Management

**Best Practices:**
- Use descriptive mount points (`/mnt/flash`)
- Ensure mount directory exists before mounting
- Use `-t` filesystem type specification for clarity
- Verify with `df -h` after mounting

## Common Scenarios and Troubleshooting

### Signature Management

**When to Remove Signatures:**
- Reusing partitions with previous filesystems
- Cleaning corrupted filesystem remnants
- Preparing for new filesystem type

**Safety Considerations:**
- Signature removal doesn't erase data
- Previous data remains until overwritten
- Always verify partition selection

### Capacity Planning

**Realistic Space Allocation:**
- Account for 10-15% filesystem overhead
- Reserve 5% for root (ext* filesystems)
- Consider journal size for journaling filesystems
- Plan for inode requirements based on file count

## Advanced Topics

### Filesystem Optimization

**ext3 Tuning Options:**
- **Journal Size**: Adjustable during creation
- **Block Size**: 1K, 2K, 4K (default) based on file sizes
- **Reserved Blocks**: Custom percentage for root
- **Inode Count**: Pre-allocation based on expected file count

### Recovery Preparedness

**lost+found Functionality:**
```bash
# Manual filesystem check
sudo fsck /dev/sdb5

# Recovered files appear in lost+found
ls -la /mnt/flash/lost+found/
```

**Best Practices:**
- Never delete `lost+found` directory
- Regular `fsck` on unmounted filesystems
- Monitor filesystem health with `dmesg` and logs

## Summary

This practical demonstration shows the complete lifecycle of Linux storage management:

1. **Partition Creation**: Extended container with logical partitions
2. **Filesystem Formatting**: ext3 with journaling and proper metadata
3. **Mounting Operation**: Integration into directory hierarchy
4. **Verification**: Capacity checking and filesystem validation

The automatic creation of `lost+found` demonstrates the filesystem's self-healing capabilities and recovery preparedness, making ext3 a robust choice for general-purpose storage.
