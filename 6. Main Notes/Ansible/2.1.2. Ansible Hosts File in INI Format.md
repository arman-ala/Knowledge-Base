# 2.1.2. Ansible Hosts File in INI Format

2025-08-06 22:59
Status: #DONE 
Tags: [[Ansible]]

---
# Writing Ansible Hosts File in INI Format: A Comprehensive Guide

## Introduction

Ansible is a robust automation tool that relies on an inventory file to define and manage hosts (servers or nodes) for configuration management, application deployment, and task orchestration. The INI format is the most traditional and straightforward method for creating an Ansible inventory, particularly suitable for small to medium-sized environments. This guide provides a detailed exploration of writing an Ansible hosts file in its pure INI form, covering hosts, groups, groups of groups (nested groups), variables, and advanced features. It includes theoretical explanations and numerous practical examples to illustrate each concept, adhering to best practices for clarity and scalability.

## 1. Understanding the INI Inventory File

The Ansible inventory file specifies the hosts to be managed and organizes them into logical groups. By default, Ansible looks for the inventory file at `/etc/ansible/hosts`, but a custom file can be specified using the `-i` flag (e.g., `ansible -i inventory.ini`) or configured in `ansible.cfg`. The INI format uses a simple, text-based structure with sections denoted by square brackets (`[]`) and key-value pairs for variables.

### Key Components

- **Hosts**: Individual systems identified by IP addresses, fully qualified domain names (FQDNs), or resolvable short names.
- **Groups**: Logical collections of hosts, defined by a section header (e.g., `[webservers]`).
- **Groups of Groups**: Hierarchical structures where a parent group includes other groups using the `:children` keyword.
- **Variables**: Key-value pairs that customize host or group behavior, such as connection settings or application parameters.

### Default Groups

Ansible automatically creates two groups:

- `all`: Includes every host in the inventory.
- `ungrouped`: Includes hosts not assigned to any user-defined group.

**Example**:

```
host1.example.com
host2.example.com
```

- These hosts are part of the `ungrouped` group and can be targeted with `ansible ungrouped -m ping`.

## 2. Defining Hosts

Hosts are the systems Ansible manages, specified by their IP addresses, FQDNs, or aliases. They can be listed directly or grouped for easier management.

**Example 1: Basic Host Definition**

```
[myhosts]
192.0.2.50
192.0.2.51
192.0.2.52
```

- **Purpose**: Defines three hosts in the `myhosts` group.
- **Usage**: Run `ansible myhosts -m ping` to test connectivity to these IP addresses.

**Example 2: Hosts with FQDNs**

```
[webservers]
web1.example.com
web2.example.com
```

- **Purpose**: Lists two web servers using their domain names.
- **Usage**: Useful when DNS resolves these names to IP addresses.

**Example 3: Host Aliases**

```
[dbs]
db-primary ansible_host=192.168.1.10
db-replica ansible_host=192.168.1.11
```

- **Purpose**: Assigns aliases (`db-primary`, `db-replica`) to IP addresses for easier reference.
- **Usage**: Run `ansible db-primary -m ping` to target `192.168.1.10`.

## 3. Organizing Hosts into Groups

Groups allow logical organization of hosts based on function (e.g., `webservers`, `databases`), location (e.g., `europe`, `asia`), or environment (e.g., `dev`, `prod`). A host can belong to multiple groups.

**Example 4: Multiple Group Membership**

```
[webservers]
web1.example.com
web2.example.com

[databases]
db1.example.com
db2.example.com

[allservers]
web1.example.com
web2.example.com
db1.example.com
db2.example.com
```

- **Purpose**: Organizes hosts into `webservers`, `databases`, and a combined `allservers` group.
- **Usage**: Run `ansible allservers -m ping` to target all four hosts or `ansible webservers -m ping` for just the web servers.

**Example 5: Grouping by Environment**

```
[dev]
web1.dev.example.com
db1.dev.example.com

[prod]
web1.prod.example.com
db1.prod.example.com
```

- **Purpose**: Separates development and production environments.
- **Usage**: Run `ansible dev -m setup` to gather facts from development hosts only.

## 4. Groups of Groups (Nested Groups)

Nested groups, or groups of groups, create hierarchical structures where a parent group includes other groups using the `:children` keyword. This is useful for managing complex infrastructures.

**Example 6: Basic Nested Groups**

```
[webservers]
web1.example.com
web2.example.com

[databases]
db1.example.com
db2.example.com

[production:children]
webservers
databases
```

- **Purpose**: The `production` group includes all hosts from `webservers` and `databases`.
- **Usage**: Run `ansible production -m ping` to target all four hosts.

**Example 7: Multi-Level Nesting**

```
[paris]
host1.paris.example.com
host2.paris.example.com

[amsterdam]
host1.amsterdam.example.com
host2.amsterdam.example.com

[europe:children]
paris
amsterdam

[world:children]
europe
asia
```

- **Purpose**: Creates a hierarchy where `europe` includes `paris` and `amsterdam`, and `world` includes `europe` and `asia` (assuming `asia` is defined).
- **Usage**: Run `ansible europe -m ping` to target hosts in `paris` and `amsterdam`.

**Key Points**:

- Child groups inherit all hosts from their parent groups.
- Circular relationships (e.g., `groupA` as a child of `groupB` and vice versa) are not allowed.

## 5. Defining Variables

Variables customize host or group behavior, such as connection settings or application parameters. They can be defined at the host or group level.

### 5.1 Host Variables

Host variables are specified on the same line as the host, using key-value pairs.

**Example 8: Host Variables**

```
[webservers]
web1.example.com ansible_port=22 http_port=80
web2.example.com ansible_port=22 http_port=8080
```

- **Purpose**: Sets `http_port` to 80 for `web1.example.com` and 8080 for `web2.example.com`.
- **Usage**: In a playbook, reference `{{ http_port }}` to use these values.

### 5.2 Group Variables

Group variables are defined in a `:vars` section under the group.

**Example 9: Group Variables**

```
[webservers:vars]
ansible_port=22
http_port=80

[databases:vars]
ansible_port=22
db_name=mysql
```

- **Purpose**: Applies `http_port=80` to all `webservers` hosts and `db_name=mysql` to all `databases` hosts.
- **Usage**: Run `ansible webservers -m debug -a "msg={{ http_port }}"` to display the variable value.

### 5.3 Combining Host and Group Variables

Host variables take precedence over group variables, which in turn override parent group variables.

**Example 10: Variable Precedence**

```
[webservers:vars]
http_port=80

[webservers]
web1.example.com http_port=8080
web2.example.com
```

- **Purpose**: `web1.example.com` uses `http_port=8080` (host-level), while `web2.example.com` uses `http_port=80` (group-level).
- **Usage**: Useful for exceptions where one host needs a different configuration.

### 5.4 Behavioral Inventory Parameters

These are special variables that control how Ansible connects to hosts.

**Example 11: Behavioral Parameters**

```
[webservers]
web1.example.com ansible_user=admin ansible_ssh_private_key_file=~/.ssh/id_rsa
```

- **Purpose**: Specifies the SSH user (`admin`) and private key file for `web1.example.com`.
- **Usage**: Ensures Ansible uses the correct credentials for SSH connections.

**Common Behavioral Parameters**:

|Parameter|Description|Example Value|
|---|---|---|
|`ansible_host`|IP or hostname to connect to|`192.168.1.10`|
|`ansible_port`|SSH port|`22`|
|`ansible_user`|SSH user|`admin`|
|`ansible_ssh_private_key_file`|Path to SSH private key|`~/.ssh/id_rsa`|
|`ansible_connection`|Connection type (e.g., ssh, local)|`ssh`|

## 6. Advanced Features

### 6.1 Host Ranges

Host ranges allow you to define multiple hosts with similar naming patterns.

**Example 12: Numeric Range**

```
[webservers]
www[01:50].example.com
```

- **Purpose**: Defines hosts from `www01.example.com` to `www50.example.com`.
- **Usage**: Run `ansible webservers -m ping` to target all 50 hosts.

**Example 13: Numeric Range with Stride**

```
[webservers]
www[01:50:2].example.com
```

- **Purpose**: Defines `www01.example.com`, `www03.example.com`, ..., `www49.example.com`.
- **Usage**: Useful for targeting every other host in a sequence.

**Example 14: Alphabetic Range**

```
[databases]
db-[a:f].example.com
```

- **Purpose**: Defines `db-a.example.com`, `db-b.example.com`, ..., `db-f.example.com`.
- **Usage**: Run `ansible databases -m ping` to target these six hosts.

### 6.2 Multiple Inventory Sources

Multiple INI files can be combined during runtime.

**Example 15: Combining Inventories**

```
ansible-playbook apply_updates.yml -i dev_inventory.ini -i prod_inventory.ini
```

- **Purpose**: Combines hosts from `dev_inventory.ini` and `prod_inventory.ini`.
- **Usage**: Useful for managing multiple environments simultaneously.

## 7. Best Practices and Tips

- **Logical Grouping**: Organize hosts by function (e.g., `webservers`), location (e.g., `europe`), or environment (e.g., `dev`, `prod`) for clarity.
- **Descriptive Naming**: Use meaningful, unique group and host names. Avoid spaces, hyphens, or leading numbers (e.g., use `floor_19` instead of `19th_floor`).
- **Version Control**: Store inventory files in version control (e.g., Git), but exclude sensitive data using `.gitignore`.
- **Separate Variable Files**: For large projects, consider using `host_vars` and `group_vars` directories (in YAML format) for better organization, though this guide focuses on INI.
- **Validate Inventory**: Use `ansible-inventory -i inventory.ini --list` to verify the structure and variables.
- **Secure Sensitive Data**: Avoid storing passwords or keys in the inventory; use Ansible Vault for encryption if needed.
    
    ```bash
    ansible-vault encrypt group_vars/webservers
    ```
    
- **Test Connectivity**: Regularly test with `ansible all -m ping` to ensure hosts are reachable.

## 8. Comprehensive Examples

### Example 16: Full Inventory with Groups and Variables

```
[webservers]
web1.example.com ansible_user=admin http_port=80
web2.example.com ansible_user=admin http_port=8080

[databases]
db1.example.com ansible_user=dbadmin db_name=mysql
db2.example.com ansible_user=dbadmin db_name=postgres

[all:vars]
ansible_ssh_private_key_file=~/.ssh/id_rsa
ntp_server=ntp.example.com
```

- **Purpose**: Defines two groups with host-specific and global variables.
- **Usage**: Run `ansible webservers -m debug -a "msg={{ http_port }}"` to verify variable values.

### Example 17: Complex Nested Groups

```
[dev_web]
web1.dev.example.com
web2.dev.example.com

[prod_web]
web1.prod.example.com
web2.prod.example.com

[web:children]
dev_web
prod_web

[dev_db]
db1.dev.example.com
db2.dev.example.com

[prod_db]
db1.prod.example.com
db2.prod.example.com

[db:children]
dev_db
prod_db

[all:children]
web
db
```

- **Purpose**: Creates a hierarchy with `web` and `db` groups, each split into `dev` and `prod` subgroups, all under `all`.
- **Usage**: Run `ansible web -m ping` to target all web servers or `ansible all -m ping` for all hosts.

### Example 18: Host Ranges and Aliases

```
[loadbalancers]
lb[01:03].example.com

[dbs]
db-primary ansible_host=192.168.1.10 ansible_user=dbadmin
db-replica ansible_host=192.168.1.11 ansible_user=dbadmin
```

- **Purpose**: Uses a range for load balancers and aliases for database servers.
- **Usage**: Run `ansible loadbalancers -m ping` to target `lb01.example.com` to `lb03.example.com`.

### Example 19: Environment-Specific Inventory

```
[staging:vars]
app_version=1.0.1

[staging]
web1.staging.example.com
web2.staging.example.com

[production:vars]
app_version=1.0.2

[production]
web1.production.example.com
web2.production.example.com
```

- **Purpose**: Separates staging and production environments with different application versions.
- **Usage**: Run `ansible staging -m debug -a "msg={{ app_version }}"` to verify the staging version.

## 9. Conclusion

The Ansible inventory file in INI format is a versatile and straightforward tool for managing hosts and their configurations. By mastering the definition of hosts, groups, nested groups, and variables, administrators can create well-organized inventories that streamline automation tasks. Adhering to best practices ensures maintainability and scalability, making the INI format an excellent choice for many Ansible projects. For further details, refer to:

- [Ansible Inventory Guide](https://docs.ansible.com/ansible/latest/inventory_guide/intro_inventory.html)
- [Getting Started with Ansible Inventory](https://docs.ansible.com/ansible/latest/getting_started/get_started_inventory.html)
- [Spacelift Blog on Ansible Inventory](https://spacelift.io/blog/ansible-inventory)