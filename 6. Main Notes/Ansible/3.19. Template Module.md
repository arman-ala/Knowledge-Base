# 3.19. Template Module

2025-08-16 05:41
Status: 
Tags: 

---
## Understanding the Ansible Template Module: A Comprehensive Guide

In the realm of DevOps automation, Ansible's template module stands as a powerful tool for generating dynamic configuration files on remote hosts. By leveraging Jinja2 templating, it allows the creation of customizable files that adapt to variables, loops, and conditionals, ensuring consistency across environments. This module complements the `template` lookup plugin, which retrieves templated content without deployment. Below, we explore the module and lookup through a simplified lens for foundational understanding, followed by a detailed analysis of their parameters, including all possible values and their effects, best practices, and illustrative examples with expected outputs. The analysis incorporates practical scenarios, such as modifying nginx configurations, where the recommended approach in production is to replace the entire file for reliability, rather than editing specific lines to avoid parsing errors or inconsistencies. To address the request for template explanations, each example now includes the content of the .j2 template file, demonstrating how placeholders are used for dynamic rendering.

#### Simplified Explanation: Breaking It Down Simply

Imagine the template module as a smart copier that not only duplicates files but also fills in blanks with custom details, like a form letter with personalized names and addresses. You provide a base template file (e.g., nginx.conf.j2 with placeholders like {{ server_ip }}), and Ansible replaces those placeholders with actual values (e.g., IP addresses or environment variables) before placing the file on the server. The template lookup is like previewing that filled-in letter without sending itâ€”it generates the content for use in playbooks. For nginx configs, instead of manually editing lines on each server (risky and error-prone), you create a template once and let Ansible generate and deploy the full file, ensuring every server gets the correct, up-to-date version without partial changes.

#### In-Depth Analysis: Precise and Comprehensive Coverage

The `ansible.builtin.template` module processes Jinja2 templates (.j2 files) and deploys the rendered result to remote hosts, supporting attributes like permissions, backups, and validation. It requires Jinja2 on the control node and includes an action plugin for execution. This module is POSIX-oriented, with Windows equivalents in `win_template`.

The `ansible.builtin.template` lookup plugin retrieves templated content as strings, useful for inline use or debugging without file deployment. It shares Jinja2 options but operates in-memory.

Both use Jinja2, a Python templating language with delimiters like {{ }} for variables, {% %} for statements (loops/conditionals), and {# #} for comments. Additional variables include `ansible_managed` (customizable string with template details), `template_host` (control node name), `template_uid` (owner UID), `template_path` (template path), `template_fullpath` (absolute path), `template_destpath` (remote path), and `template_run_date` (render time).

For nginx configs, full replacement (method 1) is preferred in production: it avoids regex parsing issues in method 2 (line editing via `lineinfile`), ensuring atomic updates and reducing failure risks from malformed files.

Below, parameters for the module and lookup are analyzed, with type, default, possible values/effects, required status, and notes.

##### Template Module Parameters

- **attributes** (aliases: attr):
  - description: Sets extended filesystem attributes on the deployed file/directory using chattr.
  - Type: string. Default: None (no change). 
  - Possible values: Valid chattr strings (e.g., '+a' effect: append-only, preventing deletion; '-i' effect: removes immutable, allowing modifications; 'e' effect: enables extent format for efficiency). 
  - Required: No.
  - Notes: Order as lsattr; assumes '=' default, use +/-. Best practice: Use for security (e.g., +i on configs). Tip: Check man chattr; trick: Apply after validation.

  Example: Make nginx conf immutable.
  Template file (nginx.conf.j2):
  ```
  server {
    listen 80;
    server_name {{ domain_name }};
  }
  ```
  Playbook:
  ```yaml
  - name: Template nginx with attributes
    ansible.builtin.template:
      src: nginx.conf.j2
      dest: /etc/nginx/nginx.conf
      attributes: '+i'
  ```
  Expected output: Deploys rendered conf from nginx.conf.j2 (replacing {{ domain_name }} with variable value), sets immutable (`changed: true` if updated); lsattr shows ----i--------. The template allows dynamic server_name while the module applies attributes.

- **backup**:
  - description: Creates a timestamped backup of dest before overwriting.
  - Type: boolean. Default: false. 
  - Possible values: true (effect: backs up with timestamp, allowing rollback), false (effect: overwrites without backup). 
  - Required: No.
  - Notes: Best practice: Enable for critical files. Tip: Backups in same dir; trick: Use with register to capture path.

  Example: Backup nginx conf.
  Template file (nginx.conf.j2):
  ```
  upstream backend {
    server {{ backend_ip }}:8080;
  }
  ```
  Playbook:
  ```yaml
  - name: Template with backup
    ansible.builtin.template:
      src: nginx.conf.j2
      dest: /etc/nginx/nginx.conf
      backup: yes
  ```
  Expected output: Renders conf with backend_ip variable, deploys, creates backup if exists (`changed: true`); return: `backup_file: /etc/nginx/nginx.conf.2025.08.16@14:30~`.

- **block_end_string**:
  - description: Customizes the end delimiter for Jinja2 blocks.
  - Type: string. Default: "%}". 
  - Possible values: Any string (e.g., "]]" effect: changes block end to ]], avoiding conflicts in files with similar syntax). 
  - Required: No.
  - Notes: Added in 2.4; pair with block_start_string. Best practice: Use for templates with conflicting syntax. Tip: Consistent with start; trick: For embedded templates.

  Example: Custom block end.
  Template file (custom.j2):
  ```
  {% for server in servers %}}
  server {{ server.ip }};
  {{% endfor %}}
  ```
  Playbook:
  ```yaml
  - name: Template with custom block end
    ansible.builtin.template:
      src: custom.j2
      dest: /path/custom.conf
      block_end_string: "]]"
  ```
  Expected output: Renders loop with custom delimiter (using "{%" start and "]]" end), deploys (`changed: true`).

- **block_start_string**:
  - description: Customizes the start delimiter for Jinja2 blocks.
  - Type: string. Default: "{%". 
  - Possible values: Any string (e.g., "[[" effect: changes block start to [[, for syntax compatibility). 
  - Required: No.
  - Notes: Added in 2.4; pair with block_end_string.

  Example: Custom block start.
  Template file (custom.j2):
  ```
  [[ if env == 'prod' %}}
  log_level = error
  {{% else %}}
  log_level = debug
  {{% endif %}}
  ```
  Playbook:
  ```yaml
  - name: Template with custom block start
    ansible.builtin.template:
      src: custom.j2
      dest: /path/custom.conf
      block_start_string: "[["
  ```
  Expected output: Renders conditional with custom start ("[[" for blocks), deploys (`changed: true`).

- **dest**:
  - description: Remote path for rendered template.
  - Type: path. Default: None. 
  - Possible values: Any path (e.g., "/etc/nginx/nginx.conf" effect: deploys there; dir/ effect: fails if not file). 
  - Required: Yes.
  - Notes: Creates parent dirs if needed.

  Example: Deploy nginx conf.
  Template file (nginx.conf.j2):
  ```
  server {
    listen {{ port | default(80) }};
    server_name {{ domain }};
  }
  ```
  Playbook:
  ```yaml
  - name: Deploy nginx conf
    ansible.builtin.template:
      src: nginx.conf.j2
      dest: /etc/nginx/nginx.conf
  ```
  Expected output: Renders with port/domain variables, deploys (`changed: true` if different); return: `dest: /etc/nginx/nginx.conf`, `checksum`.

- **force**:
  - description: Determines if deployment occurs only when dest is absent or different.
  - Type: boolean. Default: true. 
  - Possible values: true (effect: always checks and deploys if different or absent, ensuring latest), false (effect: deploys only if absent, preserves existing). 
  - Required: No.
  - Notes: Best practice: True for consistency. Tip: False for initial setups; trick: With check mode.

  Example: No force.
  Template file (init.j2):
  ```
  # Initial config
  version = {{ app_version }}
  ```
  Playbook:
  ```yaml
  - name: Template no force
    ansible.builtin.template:
      src: init.j2
      dest: /etc/init.conf
      force: false
  ```
  Outcome: Deploys only if absent (`changed: true` if new); skips if exists.

- **group**:
  - description: Sets group ownership of dest.
  - Type: string. Default: None (preserves or system default). 
  - Possible values: Any group (e.g., "nginx" effect: group owns file). 
  - Required: No.

  Example: Set group nginx.
  Template file (nginx.conf.j2):
  ```
  worker_processes {{ worker_count }};
  ```
  Playbook:
  ```yaml
  - name: Template with group
    ansible.builtin.template:
      src: nginx.conf.j2
      dest: /etc/nginx/nginx.conf
      group: nginx
  ```
  Expected output: Renders with worker_count, sets group (`changed: true` if changed); return: `group: nginx`, `gid`.

- **lstrip_blocks**:
  - description: Strips leading whitespace from blocks if true.
  - Type: boolean. Default: false. 
  - Possible values: true (effect: removes whitespace, cleans output for better formatting), false (effect: preserves newlines, maintains original indentation). 
  - Required: No.
  - Notes: Added in 2.12; Jinja2 option.

  Example: Lstrip blocks.
  Template file (indented.j2):
  ```
    {% for item in list %}
  - {{ item }}
    {% endfor %}
  ```
  Playbook:
  ```yaml
  - name: Template lstrip
    ansible.builtin.template:
      src: indented.j2
      dest: /path/file
      lstrip_blocks: true
  ```
  Expected output: Renders without leading spaces in loop (`changed: true`).

- **mode**:
  - description: Sets permissions of dest.
  - Type: any. Default: None (preserves or umask). 
  - Possible values: Octal (e.g., '0644' effect: rw-r--r-- for owner/group/others), symbolic (e.g., 'u=rw,g=r,o=r' effect: same as 0644, adds readability), 'preserve' (effect: matches src mode, for consistency). 
  - Required: No.
  - Notes: Quote octals to avoid interpretation as integers; 'preserve' useful for mirroring local perms.

  Example: Set mode 0600.
  Template file (secret.j2):
  ```
  api_key = {{ secret_key }}
  ```
  Playbook:
  ```yaml
  - name: Template with mode
    ansible.builtin.template:
      src: secret.j2
      dest: /etc/secret.conf
      mode: '0600'
  ```
  Expected output: Renders with secret_key, sets 0600 (`changed: true`); return: `mode: 0600`.

- **newline_sequence**:
  - description: Sets line endings in rendered file.
  - Type: string. Default: "\n" (Unix LF). 
  - Possible values: "\n" (effect: LF endings, standard for Unix), "\r" (effect: CR endings, legacy Mac), "\r\n" (effect: CRLF, Windows standard). 
  - Required: No.
  - Notes: Added in 2.8; ensures cross-platform compatibility.

  Example: Windows endings.
  Template file (win.ini.j2):
  ```
  [settings]
  path = {{ win_path }}
  ```
  Playbook:
  ```yaml
  - name: Template Windows newline
    ansible.builtin.template:
      src: win.ini.j2
      dest: /share/config.ini
      newline_sequence: "\r\n"
  ```
  Expected output: Renders with CRLF (`changed: true`).

- **output_encoding**:
  - description: Encoding for the rendered output file.
  - Type: string. Default: "utf-8". 
  - Possible values: Any valid encoding (e.g., "utf-16" effect: uses UTF-16 for international chars, "ascii" effect: limits to ASCII). 
  - Required: No.
  - Notes: Added in 2.12; useful for legacy systems.

  Example: UTF-16 output.
  Template file (unicode.j2):
  ```
  text = {{ unicode_text }}
  ```
  Playbook:
  ```yaml
  - name: Template UTF-16
    ansible.builtin.template:
      src: unicode.j2
      dest: /path/unicode.txt
      output_encoding: utf-16
  ```
  Expected output: Renders in UTF-16 (`changed: true`).

- **owner**:
  - description: Sets owner of dest.
  - Type: string. Default: None (preserves or root if become). 
  - Possible values: Any user (e.g., "root" effect: root owns file). 
  - Required: No.

  Example: Set owner root.
  Template file (root.j2):
  ```
  # Root config
  setting = {{ root_setting }}
  ```
  Playbook:
  ```yaml
  - name: Template with owner
    ansible.builtin.template:
      src: root.j2
      dest: /etc/root.conf
      owner: root
  ```
  Expected output: Renders with root_setting, sets owner (`changed: true`); return: `owner: root`, `uid`.

- **selevel**: Sets SELinux level.
  - description: SELinux MLS/MCS level for dest.
  - Type: string. Default: None. 
  - Possible values: Any level (e.g., 's0' effect: sets level for policy compliance). 
  - Required: No.
  - Notes: Requires libselinux-python; best practice: Use in enforcing mode. Tip: Match fcontexts; trick: Use `restorecon`.

  Example: Set selevel.
  Template file (sel.j2):
  ```
  secure_setting = {{ secure_var }}
  ```
  Playbook:
  ```yaml
  - name: Template SELinux level
    ansible.builtin.template:
      src: sel.j2
      dest: /sel/file
      selevel: s0
  ```
  Expected output: Applies level (`changed: true`).

- **serole**: Sets SELinux role.
  - description: SELinux role for dest.
  - Type: string. Default: None. 
  - Possible values: Any role (e.g., 'object_r' effect: sets role). 
  - Required: No.

- **setype**: Sets SELinux type.
  - description: SELinux type for dest.
  - Type: string. Default: None. 
  - Possible values: Any type (e.g., 'httpd_sys_content_t' effect: sets type for httpd). 
  - Required: No.

- **seuser**: Sets SELinux user.
  - description: SELinux user for dest.
  - Type: string. Default: None. 
  - Possible values: Any user (e.g., 'system_u' effect: sets user). 
  - Required: No.

- **src**:
  - description: Path to Jinja2 template on control node.
  - Type: path. Default: None. 
  - Possible values: Any .j2 path (e.g., "nginx.conf.j2" effect: renders and deploys). 
  - Required: Yes.
  - Notes: Relative to playbook/role.

  Example: Src nginx.j2.
  Template file (nginx.conf.j2):
  ```
  server {
    listen {{ port | default(80) }};
    server_name {{ domain }};
  }
  ```
  Playbook:
  ```yaml
  - name: Template src
    ansible.builtin.template:
      src: nginx.conf.j2
      dest: /etc/nginx/nginx.conf
  ```
  Expected output: Renders with port/domain variables, deploys (`changed: true` if different); return: `src: /path/to/nginx.conf.j2`.

- **trim_blocks**:
  - description: Removes trailing newline from blocks if true.
  - Type: boolean. Default: true. 
  - Possible values: true (effect: cleans output by stripping newlines after blocks), false (effect: preserves newlines, maintaining original formatting). 
  - Required: No.
  - Notes: Added in 2.4; Jinja2 option.

  Example: No trim.
  Template file (blocks.j2):
  ```
  {% for item in list %}
  - {{ item }}
  {% endfor %}
  ```
  Playbook:
  ```yaml
  - name: Template no trim
    ansible.builtin.template:
      src: blocks.j2
      dest: /path/file
      trim_blocks: false
  ```
  Expected output: Renders with newlines after loop (`changed: true`).

- **unsafe_writes**:
  - description: Allows unsafe writes to devices/pipes.
  - Type: boolean. Default: false. 
  - Possible values: true (effect: writes to special files, enabling advanced use cases but with race risks), false (effect: restricts to regular files for safety). 
  - Required: No.

  Example: Unsafe write.
  Template file (dev.j2):
  ```
  log_level = {{ log_level }}
  ```
  Playbook:
  ```yaml
  - name: Template unsafe
    ansible.builtin.template:
      src: dev.j2
      dest: /dev/log
      unsafe_writes: true
  ```
  Expected output: Writes to device (`changed: true`).

- **validate**:
  - description: Runs command to validate rendered file before deployment.
  - Type: string. Default: None. 
  - Possible values: Command with %s (e.g., "/usr/sbin/visudo -cf %s" effect: checks syntax, fails if invalid; %s is temp file placeholder). 
  - Required: No.
  - Notes: Best practice: Use for syntax-sensitive files like nginx/sudoers. Tip: %s required; trick: Include custom scripts.

  Example: Validate nginx conf.
  Template file (nginx.conf.j2):
  ```
  server {
    listen {{ port }};
    {{ '#' if debug else '' }} log_level debug;
  }
  ```
  Playbook:
  ```yaml
  - name: Validate nginx template
    ansible.builtin.template:
      src: nginx.conf.j2
      dest: /etc/nginx/nginx.conf
      validate: 'nginx -t -c %s'
  ```
  Expected output: Validates syntax (`changed: true` if valid and different); fails if invalid.

#### Template Lookup Parameters

- **comment_end_string**:
  - description: Customizes end delimiter for Jinja2 comments.
  - Type: string. Default: "#}". 
  - Possible values: Any string (e.g., "-->" effect: changes comment end to -->, for HTML-like syntax). 
  - Required: No.
  - Notes: Added in 2.12; for conflicting syntax.

  Example: Custom comment end.
  Template file (comment.j2):
  ```
  {# This is a comment #}
  value = {{ var }}
  ```
  Playbook:
  ```yaml
  - name: Lookup with custom comment end
    ansible.builtin.debug:
      msg: "{{ lookup('ansible.builtin.template', 'comment.j2', comment_end_string='-->') }}"
  ```
  Expected output: Renders content with custom comment delimiter (# ... -->).

- **comment_start_string**:
  - description: Customizes start delimiter for Jinja2 comments.
  - Type: string. Default: "{#". 
  - Possible values: Any string (e.g., `<!--` effect: changes comment start to `<!--`, for HTML compatibility). 
  - Required: No.
  - Notes: Added in 2.12.

  Example: Custom comment start.
  Template file (comment.j2):
  ```
  <!-- This is a comment #}
  value = {{ var }}
  ```
  Playbook:
  ```yaml
  - name: Lookup with custom comment start
    ansible.builtin.debug:
      msg: "{{ lookup('ansible.builtin.template', 'comment.j2', comment_start_string='<!--') }}"
  ```
  Expected output: Renders with custom comment (`<!-- ... #}`).

- **convert_data**:
  - description: Converts YAML strings to data structures if true.
  - Type: boolean. Default: true. 
  - Possible values: true (effect: parses YAML content into dicts/lists for further manipulation), false (effect: treats YAML as plain strings, preserving format). 
  - Required: No.
  - Notes: Mutually exclusive with jinja2_native; best practice: False for raw YAML output. Tip: Useful for config files with YAML blocks.

  Example: No convert.
  Template file (yaml.j2):
  ```
  yaml_content: |
    key: {{ yaml_var }}
  ```
  Playbook:
  ```yaml
  - name: Lookup no convert
    ansible.builtin.debug:
      msg: "{{ lookup('ansible.builtin.template', 'yaml.j2', convert_data=false) }}"
  ```
  Expected output: Treats YAML as string (`changed: false`).

- **jinja2_native**:
  - description: Enables Jinja2 native types for advanced rendering, preserving Python types like int/str.
  - Type: boolean. Default: false. 
  - Possible values: true (effect: uses native types for precise operations, e.g., math on numbers), false (effect: treats all as strings, standard behavior). 
  - Required: No.
  - Notes: Added in 2.11; mutually exclusive with convert_data; no effect if global jinja2_native false. Best practice: True for complex logic. Tip: Enables type-aware filters.

  Example: Native Jinja2.
  Template file (native.j2):
  ```
  sum: {{ num1 + num2 }}
  ```
  Playbook:
  ```yaml
  - name: Lookup native
    ansible.builtin.debug:
      msg: "{{ lookup('ansible.builtin.template', 'native.j2', jinja2_native=true) }}"
  ```
  Expected output: Renders with native addition (e.g., sum: 5 for 2+3).

- **template_vars**:
  - description: Additional variables available for templating.
  - Type: dictionary. Default: {}. 
  - Possible values: Any dict (e.g., {"env": "prod"} effect: exposes env in template). 
  - Required: No.
  - Notes: Supplements playbook vars. Best practice: Use for lookup-specific data. Tip: Override globals; trick: For conditional rendering.

  Example: Extra vars.
  Template file (vars.j2):
  ```
  environment: {{ env }}
  ```
  Playbook:
  ```yaml
  - name: Lookup with vars
    ansible.builtin.debug:
      msg: "{{ lookup('ansible.builtin.template', 'vars.j2', template_vars={'env': 'staging'}) }}"
  ```
  Expected output: Renders with staging env.

- **variable_end_string**:
  - description: Customizes end delimiter for Jinja2 variables.
  - Type: string. Default: "}}". 
  - Possible values: Any string (e.g., "]" effect: changes var end to ], for syntax avoidance). 
  - Required: No.
  - Notes: Added in 2.8; pair with variable_start_string.

  Example: Custom var end.
  Template file (var.j2):
  ```
  value = {{ var }}
  ```
  Playbook:
  ```yaml
  - name: Lookup custom var end
    ansible.builtin.debug:
      msg: "{{ lookup('ansible.builtin.template', 'var.j2', variable_end_string=']') }}"
  ```
  Expected output: Renders with custom ({{ var ]] becomes value).

- **variable_start_string**:
  - description: Customizes start delimiter for Jinja2 variables.
  - Type: string. Default: "{{". 
  - Possible values: Any string (e.g., "[" effect: changes var start to [). 
  - Required: No.
  - Notes: Added in 2.8.

  Example: Custom var start.
  Template file (var.j2):
  ```
  value = [[ var }}
  ```
  Playbook:
  ```yaml
  - name: Lookup custom var start
    ansible.builtin.debug:
      msg: "{{ lookup('ansible.builtin.template', 'var.j2', variable_start_string='[') }}"
  ```
  Expected output: Renders with custom ([ var }} becomes value).

### Practical Examples and Expected Outcomes

1. **Template Nginx Conf with Variables**:
   Template file (nginx.conf.j2):
   ```
   server {
     listen 80;
     server_name {{ domain_name }};
   }
   ```
   Playbook:
   ```yaml
   - name: Template nginx conf
     ansible.builtin.template:
       src: nginx.conf.j2
       dest: /etc/nginx/nginx.conf
       owner: root
       group: root
       mode: '0644'
       backup: yes
       force: yes
  ```
   Outcome: Renders nginx.conf.j2 (replacing {{ domain_name }} with variable value, e.g., "example.com"), deploys to dest, backs up if exists (`changed: true` if different); return: `checksum`, `dest`, `backup_file` if backed. The template uses a variable for dynamic server_name.

2. **Lookup Template Content**:
   Template file (preview.j2):
   ```
   # Preview config
   env = {{ env_type }}
   ```
   Playbook:
   ```yaml
   - name: Preview template
     ansible.builtin.debug:
       msg: "{{ lookup('ansible.builtin.template', 'preview.j2', template_vars={'env_type': 'dev'}) }}"
  ```
   Outcome: Prints rendered content ("# Preview config\nenv = dev") without deployment (`changed: false`); useful for verification. The template demonstrates inline variable substitution via template_vars.

3. **Validate Nginx Conf Before Deploy**:
   Template file (nginx.conf.j2):
   ```
   server {
     listen {{ port | default(80) }};
     server_name {{ domain }};
   }
   ```
   Playbook:
   ```yaml
   - name: Validate nginx template
     ansible.builtin.template:
       src: nginx.conf.j2
       dest: /etc/nginx/nginx.conf
       validate: 'nginx -t -c %s'
  ```
   Outcome: Renders nginx.conf.j2 (with port/domain variables), validates syntax via nginx -t on temp file (`changed: true` if valid and different); fails if invalid. The template includes a default for port to handle missing variables.

4. **Template with SELinux Context**:
   Template file (sel.j2):
   ```
   secure_setting = {{ secure_var | quote }}
   ```
   Playbook:
   ```yaml
   - name: Template with SELinux
    ansible.builtin.template:
      src: sel.j2
      dest: /sel/file
      setype: httpd_sys_content_t
  ```
   Outcome: Renders sel.j2 (quoting secure_var for safety), deploys with SELinux type (`changed: true`). The template uses a filter to escape values.

5. **Custom Newline for Windows**:
   Template file (win.ini.j2):
   ```
   [settings]
   path = {{ win_path }}
   ```
   Playbook:
   ```yaml
   - name: Template Windows newline
     ansible.builtin.template:
       src: win.ini.j2
       dest: /share/config.ini
       newline_sequence: "\r\n"
  ```
   Outcome: Renders win.ini.j2 with CRLF line endings (`changed: true`), suitable for Windows parsing. The template is simple, focusing on path variable.

#### Best Practices and Considerations

- **Idempotency**: Leverage force: false for initial deploys to avoid unnecessary checks, enhancing efficiency in large-scale environments.
- **Security**: Employ mode: '0600' for sensitive files to restrict access; use validate to prevent deployment of invalid configurations that could cause service failures.
- **Jinja2 Customization**: Adjust delimiters (e.g., block_start_string) for templates embedded in files with similar syntax, such as ERB in Ruby configs.
- **Backup and Validation**: Always enable backup for critical files to facilitate rollback; incorporate validate with custom scripts for complex validations beyond built-in tools.
- **Lookup Use**: Utilize the lookup for previewing rendered content in debug tasks or injecting into variables, ideal for conditional logic without file writes.

## More Examples for the Ansible Template Module

#### Example 1: Basic Template with Variables
**Playbook Task:**
```yaml
- name: Deploy basic config with variables
  ansible.builtin.template:
    src: basic.conf.j2
    dest: /etc/basic.conf
    owner: root
    group: root
    mode: '0644'
```

**Template File (basic.conf.j2):**
```
# Basic configuration file
# Managed by Ansible
server_name = {{ server_name }}
port = {{ port | default(80) }}
debug = {{ debug | lower }}
```

**Expected Output:** Renders the template with variables replaced (e.g., server_name="example.com", port=80, debug="true" becomes "debug = true"). Deploys to /etc/basic.conf with specified permissions. Output shows `changed: true` if the file was created or changed.

#### Example 2: Template with Loop
**Playbook Task:**
```yaml
- name: Deploy config with loop
  ansible.builtin.template:
    src: loop.conf.j2
    dest: /etc/loop.conf
```

**Template File (loop.conf.j2):**
```
# Configuration with loop
{% for user in users %}
user {{ user.name }} has UID {{ user.uid }}
{% endfor %}
```

**Expected Output:** Renders a list of users from the `users` variable (e.g., if users is a list of dicts with name and uid, it will generate multiple lines). Deploys to /etc/loop.conf. Output shows `changed: true` if the file was created or changed.

#### Example 3: Template with Conditionals
**Playbook Task:**
```yaml
- name: Deploy config with conditionals
  ansible.builtin.template:
    src: conditional.conf.j2
    dest: /etc/conditional.conf
```

**Template File (conditional.conf.j2):**
```
# Configuration with conditionals
{% if use_tls %}
tls_enabled = true
tls_cert_path = /etc/ssl/cert.pem
{% else %}
tls_enabled = false
{% endif %}
```

**Expected Output:** Renders based on the `use_tls` variable. If true, includes TLS settings; if false, sets tls_enabled to false. Deploys to /etc/conditional.conf. Output shows `changed: true` if the file was created or changed.

#### Example 4: Template with Backup
**Playbook Task:**
```yaml
- name: Deploy config with backup
  ansible.builtin.template:
    src: backup.conf.j2
    dest: /etc/backup.conf
    backup: yes
```

**Template File (backup.conf.j2):**
```
# Configuration with backup
app_version = {{ app_version }}
```

**Expected Output:** Renders the template and deploys to /etc/backup.conf. If the file existed, creates a timestamped backup (e.g., /etc/backup.conf.2025-08-16@14:30~). Output shows `changed: true` and `backup_file` if a backup was created.

#### Example 5: Template with Validation
**Playbook Task:**
```yaml
- name: Deploy nginx config with validation
  ansible.builtin.template:
    src: nginx.conf.j2
    dest: /etc/nginx/nginx.conf
    validate: 'nginx -t -c %s'
```

**Template File (nginx.conf.j2):**
```
server {
    listen {{ port | default(80) }};
    server_name {{ domain }};
    root /var/www/html;
}
```

**Expected Output:** Renders the template and validates the syntax with `nginx -t -c` on a temporary file. If valid, deploys to /etc/nginx/nginx.conf. Output shows `changed: true` if the file was created or changed and valid. Fails if invalid.

#### Example 6: Template with Custom Delimiters
**Playbook Task:**
```yaml
- name: Deploy template with custom delimiters
  ansible.builtin.template:
    src: custom.j2
    dest: /etc/custom.conf
    variable_start_string: '[['
    variable_end_string: ']]'
```

**Template File (custom.j2):**
```
# Custom delimiters example
setting = [[ setting_value ]]
```

**Expected Output:** Renders the template using custom delimiters `[[` and `]]` instead of `{{` and `}}`. Deploys to /etc/custom.conf. Output shows `changed: true` if the file was created or changed.

#### Example 7: Template with SELinux Context
**Playbook Task:**
```yaml
- name: Deploy template with SELinux context
  ansible.builtin.template:
    src: selinux.conf.j2
    dest: /etc/selinux.conf
    setype: httpd_sys_content_t
    seuser: system_u
```

**Template File (selinux.conf.j2):**
```
# SELinux context example
setting = {{ setting_value }}
```

**Expected Output:** Renders the template and sets the SELinux type to `httpd_sys_content_t` and user to `system_u`. Deploys to /etc/selinux.conf. Output shows `changed: true` if the file was created or changed.

#### Example 8: Template with Trim Blocks
**Playbook Task:**
```yaml
- name: Deploy template with trim blocks
  ansible.builtin.template:
    src: trim.j2
    dest: /etc/trim.conf
    trim_blocks: true
```

**Template File (trim.j2):**
```
{% for item in items %}
- {{ item }}
{% endfor %}
```

**Expected Output:** Renders the template and removes trailing newlines after each block. Deploys to /etc/trim.conf. Output shows `changed: true` if the file was created or changed.

#### Example 9: Template with Force Disabled
**Playbook Task:**
```yaml
- name: Deploy template only if absent
  ansible.builtin.template:
    src: force.conf.j2
    dest: /etc/force.conf
    force: false
```

**Template File (force.conf.j2):**
```
# Force disabled example
version = {{ version }}
```

**Expected Output:** Deploys the template only if the destination file does not exist. If the file exists, it is left unchanged. Output shows `changed: true` only if the file was created.

#### Example 10: Template with Newline Sequence for Windows
**Playbook Task:**
```yaml
- name: Deploy template with Windows line endings
  ansible.builtin.template:
    src: windows.ini.j2
    dest: /mnt/share/windows.ini
    newline_sequence: "\r\n"
```

**Template File (windows.ini.j2):**
```
[settings]
path = {{ windows_path }}
```

**Expected Output:** Renders the template with CRLF line endings suitable for Windows. Deploys to /mnt/share/windows.ini. Output shows `changed: true` if the file was created or changed.

#### Example 11: Template with Attributes
**Playbook Task:**
```yaml
- name: Deploy template with attributes
  ansible.builtin.template:
    src: attr.conf.j2
    dest: /etc/attr.conf
    attributes: '+i'
```

**Template File (attr.conf.j2):**
```
# Attributes example
setting = {{ setting_value }}
```

**Expected Output:** Renders the template and sets the immutable attribute (`+i`) on the file. Deploys to /etc/attr.conf. Output shows `changed: true` if the file was created or changed.

#### Example 12: Template with Output Encoding
**Playbook Task:**
```yaml
- name: Deploy template with UTF-16 encoding
  ansible.builtin.template:
    src: utf16.j2
    dest: /etc/utf16.conf
    output_encoding: utf-16
```

**Template File (utf16.j2):**
```
# UTF-16 example
text = {{ text_value }}
```

**Expected Output:** Renders the template and saves it in UTF-16 encoding. Deploys to /etc/utf16.conf. Output shows `changed: true` if the file was created or changed.

#### Example 13: Template with Lstrip Blocks
**Playbook Task:**
```yaml
- name: Deploy template with lstrip blocks
  ansible.builtin.template:
    src: lstrip.j2
    dest: /etc/lstrip.conf
    lstrip_blocks: true
```

**Template File (lstrip.j2):**
```
    {% for item in items %}
    - {{ item }}
    {% endfor %}
```

**Expected Output:** Renders the template and removes leading whitespace from the blocks. Deploys to /etc/lstrip.conf. Output shows `changed: true` if the file was created or changed.

#### Example 14: Template with Unsafe Writes
**Playbook Task:**
```yaml
- name: Deploy template to device
  ansible.builtin.template:
    src: device.j2
    dest: /dev/log
    unsafe_writes: true
```

**Template File (device.j2):**
```
# Device write example
log_level = {{ log_level }}
```

**Expected Output:** Renders the template and writes to a device file. Deploys to /dev/log. Output shows `changed: true` if the file was created or changed.

#### Example 15: Template with Lookup Plugin
**Playbook Task:**
```yaml
- name: Use template lookup
  ansible.builtin.debug:
    msg: "{{ lookup('ansible.builtin.template', 'lookup.j2', template_vars={'env': 'prod'}) }}"
```

**Template File (lookup.j2):**
```
# Lookup example
environment = {{ env }}
```

**Expected Output:** Renders the template with the additional variable `env` set to 'prod' and outputs it as a debug message. No file is deployed. Output shows the rendered content in the debug message.

### Summary Table of Arguments (Module)

| Argument Name      | Type    | Default Value | Possible Values and Effects                                | Required | Notes/Deprecations |
| ------------------ | ------- | ------------- | ---------------------------------------------------------- | -------- | ------------------ |
| attributes (attr)  | string  | None          | chattr strings (e.g., '+a' append-only)                    | No       | Order as lsattr    |
| backup             | boolean | false         | true (backs up with timestamp), false (no backup)          | No       | -                  |
| block_end_string   | string  | "%}"          | Any string (custom block end)                              | No       | Added 2.4          |
| block_start_string | string  | "{%"          | Any string (custom block start)                            | No       | Added 2.4          |
| dest               | path    | None          | Any path (deploys rendered file)                           | Yes      | -                  |
| force              | boolean | true          | true (deploys if different/absent), false (only if absent) | No       | -                  |
| group              | string  | None          | Any group (sets group ownership)                           | No       | -                  |
| lstrip_blocks      | boolean | false         | true (strips whitespace from blocks), false (preserves)    | No       | Added 2.12         |
| mode               | any     | None          | Octal/symbolic/'preserve' (sets perms)                     | No       | Quote octals       |
| newline_sequence   | string  | "\n"          | "\n" (LF), "\r" (CR), "\r\n" (CRLF)                        | No       | Added 2.8          |
| output_encoding    | string  | "utf-8"       | Any encoding (encodes output)                              | No       | Added 2.12         |
| owner              | string  | None          | Any user (sets ownership)                                  | No       | -                  |
| selevel            | string  | None          | Any level (sets SELinux level)                             | No       | -                  |
| serole             | string  | None          | Any role (sets SELinux role)                               | No       | -                  |
| setype             | string  | None          | Any type (sets SELinux type)                               | No       | -                  |
| seuser             | string  | None          | Any user (sets SELinux user)                               | No       | -                  |
| src                | path    | None          | .j2 path (template source)                                 | Yes      | -                  |
| trim_blocks        | boolean | true          | true (removes newline from blocks), false (preserves)      | No       | Added 2.4          |
| unsafe_writes      | boolean | false         | true (writes to devices/pipes), false (safe)               | No       | -                  |
| validate           | string  | None          | Command with %s (validates temp file)                      | No       | -                  |

### Summary Table of Arguments (Lookup)

| Argument Name | Type | Default Value | Possible Values and Effects | Required | Notes/Deprecations |
|---------------|------|---------------|------------------------------|----------|--------------------|
| comment_end_string | string | "#}" | Any string (custom comment end) | No | Added 2.12 |
| comment_start_string | string | "{#" | Any string (custom comment start) | No | Added 2.12 |
| convert_data | boolean | true | true (parses YAML), false (leaves strings) | No | Mutually exclusive with jinja2_native |
| jinja2_native | boolean | false | true (native types), false (standard) | No | Added 2.11 |
| template_vars | dictionary | {} | Any dict (additional vars for template) | No | - |
| variable_end_string | string | "}}" | Any string (custom var end) | No | Added 2.8 |
| variable_start_string | string | "{{" | Any string (custom var start) | No | Added 2.8 |
