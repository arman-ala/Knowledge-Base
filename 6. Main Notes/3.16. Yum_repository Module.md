# 3.16. Yum_repository Module

2025-08-14 15:52
Status: #DONE 
Tags: [[Ansible]]

---
### Understanding the Ansible Yum Repository Module: A Comprehensive Guide
In the realm of DevOps automation, Ansible's built-in modules facilitate consistent system configuration across RPM-based Linux distributions such as CentOS, RHEL, and Fedora. The `ansible.builtin.yum_repository` module is specifically designed to add or remove YUM repositories by managing repository configuration files in /etc/yum.repos.d/. This module enables precise control over package sources, ensuring that systems can access the desired software repositories while maintaining security and consistency. This document provides a detailed analysis of the module, including a simplified overview for foundational understanding, followed by an in-depth examination of each parameter with structured explanations and unique examples. Complex topics such as "GPG" (GNU Privacy Guard, used for verifying package signatures to ensure authenticity and prevent tampering) and "async" (parallel downloading, now deprecated) are explained thoroughly to enhance comprehension.
#### Simplified Explanation: Breaking It Down Simply
Imagine the `yum_repository` module as a librarian who organizes and updates the catalog of software sources for your RPM-based system. It creates or deletes repository files (e.g., .repo files in /etc/yum.repos.d/) where yum or dnf looks for packages. You specify a repository name, description, and location (like a URL), and set options like enabling GPG checks to verify package authenticity. For example, adding the EPEL repo lets you install extra packages, while removing it stops using that source. It’s idempotent—changes only happen if needed—and works with other yum tasks to keep your system up-to-date from trusted sources.
#### In-Depth Analysis: Precise and Comprehensive Coverage
The `ansible.builtin.yum_repository` module, part of `ansible-core`, manages YUM repository definitions by creating, modifying, or removing .repo files in /etc/yum.repos.d/. It requires root privileges (via become) and supports `check_mode` for dry runs and `diff_mode` for change previews. The module ensures idempotency by only updating files when parameters differ from the current state, preserving section order and alphabetically sorting parameters within sections of existing files. All comments are removed during modifications, and a repo file is deleted if it contains no repositories after an operation.
The module handles GPG (GNU Privacy Guard), an open-source implementation of the OpenPGP standard, to verify package signatures using public keys, ensuring packages are untampered and from trusted vendors. Disabling GPG checks (via `gpgcheck: no`) bypasses this security, suitable only for internal or unsigned repos but risking malicious content. The `async` parameter, which enabled parallel downloads of packages and metadata, is deprecated due to its removal in RHEL 8 and will be removed in ansible-core 2.22; it is set to `null` in affected versions to avoid errors. The module integrates with yum commands, and manual cleanup of metadata cache (e.g., via `yum clean all`) may be needed after removals, often handled by a notify handler.
Below, each parameter is analyzed with structured details, including description, type/default, possible values/effects, required status, and notes, followed by unique examples.
##### Yum Repository Module Parameters
- **async**:
  - description: Determines if Yum will download packages and metadata from this repository in parallel, if supported by the system, to improve performance in multi-source setups.
  - Type: boolean. Default: true (in ansible-core 2.11-2.13), null (recommended for compatibility).
  - Possible values: true (effect: enables parallel downloads where supported, speeding up operations but now unsupported in RHEL 8), false (effect: disables parallel downloads, ensuring sequential processing), null (effect: avoids passing the option, avoiding errors on modern systems).
  - Required: No.
  - Notes: Deprecated; removed in ansible-core 2.22 due to RHEL 8 removal; set to null for compatibility with versions 2.11-2.13.
  Unique example: Disable async on legacy system.
  ```yaml
  - name: Add repo with async disabled
    ansible.builtin.yum_repository:
      name: legacyrepo
      description: Legacy Repo
      baseurl: http://legacy.repo/centos/8/
      async: false
  ```
  Expected output: Adds repo with sequential downloads (`changed: true`); compatible with older yum.
- **attributes** (aliases: attr):
  - description: Specifies the attributes to apply to the resulting filesystem object (e.g., the .repo file) using filesystem extended attributes, controlled via the `chattr` command.
  - Type: string. Default: None.
  - Possible values: Valid `chattr` strings (e.g., '+i' effect: makes file immutable, preventing modifications, '=a' effect: sets append-only, '+u' effect: allows undeletion), ordered as displayed by `lsattr`.
  - Required: No.
  - Notes: Requires `chattr` support; use `man chattr` to check valid flags.
  Unique example: Set immutable repo file.
  ```yaml
  - name: Add immutable repo
    ansible.builtin.yum_repository:
      name: secure_repo
      description: Secure Repo
      baseurl: http://secure.repo/rhel/9/
      attributes: '+i'
  ```
  Expected output: Adds repo with immutable file (`changed: true`); file cannot be altered post-creation.
- **bandwidth**:
  - description: Defines the maximum network bandwidth in bytes per second available for downloads from this repository, used in conjunction with the `throttle` option to manage network usage.
  - Type: string. Default: "0" (no throttling).
  - Possible values: Numeric string (e.g., "1048576" effect: limits to 1MB/s, "0" effect: disables throttling if `throttle` is percentage, ignored if `throttle` is bytes/sec).
  - Required: No.
  - Notes: Works with `throttle`; ignored if `throttle` specifies a rate.
  Unique example: Limit bandwidth to 500KB/s.
  ```yaml
  - name: Add repo with bandwidth limit
    ansible.builtin.yum_repository:
      name: limited_repo
      description: Limited Bandwidth Repo
      baseurl: http://limited.repo/fedora/40/
      bandwidth: "512000"
      throttle: "50%"
  ```
  Expected output: Adds repo with 500KB/s cap (`changed: true`); throttles downloads.
- **baseurl**:
  - description: Specifies the URL or list of URLs pointing to the directory containing the yum repository’s ‘repodata’ directory, defining the primary source for package downloads.
  - Type: list / elements=string. Default: None.
  - Possible values: Single URL (e.g., "http://repo.example.com/centos/8/" effect: uses one source), list of URLs (effect: tries multiple mirrors in order).
  - Required: No (but typically yes for functional repos).
  - Notes: Replaces `mirrorlist` if both specified; supports $releasever and $basearch.
  Unique example: Use multiple mirrors.
  ```yaml
  - name: Add repo with multiple mirrors
    ansible.builtin.yum_repository:
      name: multi_mirror
      description: Multi-Mirror Repo
      baseurl:
        - http://mirror1.example.com/rhel/9/
        - http://mirror2.example.com/rhel/9/
  ```
  Expected output: Adds repo with fallback mirrors (`changed: true`).
- **cost**:
  - description: Assigns a cost value to the repository, influencing yum’s preference when selecting packages from multiple sources, with lower costs preferred.
  - Type: string. Default: "1000".
  - Possible values: Numeric string (e.g., "500" effect: prioritizes this repo, "2000" effect: deprioritizes).
  - Required: No.
  - Notes: Used with `priority` plugin for repo ranking.
  Unique example: Set low-cost repo.
  ```yaml
  - name: Add low-cost repo
    ansible.builtin.yum_repository:
      name: priority_repo
      description: High Priority Repo
      baseurl: http://priority.repo/centos/7/
      cost: "300"
  ```
  Expected output: Adds repo with high preference (`changed: true`).
- **description**:
  - description: Provides a human-readable description of the repository, included in the .repo file for documentation purposes.
  - Type: string. Default: None.
  - Possible values: Any string (e.g., "Custom Dev Repo" effect: labels the repo).
  - Required: No.
  - Notes: All comments are removed during updates.
  Unique example: Detailed repo description.
  ```yaml
  - name: Add descriptive repo
    ansible.builtin.yum_repository:
      name: dev_repo
      description: Development Repository for Internal Tools
      baseurl: http://dev.repo/tools/
  ```
  Expected output: Adds repo with description (`changed: true`).
- **enabled**:
  - description: Controls whether the repository is enabled for use by yum or dnf, allowing activation or deactivation without removal.
  - Type: boolean. Default: true.
  - Possible values: true (effect: enables repo for package operations), false (effect: disables, prevents use).
  - Required: No.
  - Notes: Useful for temporary disabling.
  Unique example: Disable repo for maintenance.
  ```yaml
  - name: Add disabled repo
    ansible.builtin.yum_repository:
      name: maint_repo
      description: Maintenance Repo
      baseurl: http://maint.repo/updates/
      enabled: false
  ```
  Expected output: Adds disabled repo (`changed: true`).
- **enablegroups**:
  - description: Determines if yum should recognize and use group information from this repository, enabling group-based installs (e.g., "@group").
  - Type: boolean. Default: true.
  - Possible values: true (effect: allows group commands), false (effect: disables group support).
  - Required: No.
  - Notes: Affects group operations only.
  Unique example: Disable groups in repo.
  ```yaml
  - name: Add repo without groups
    ansible.builtin.yum_repository:
      name: nogroup_repo
      description: No Group Repo
      baseurl: http://nogroup.repo/rhel/8/
      enablegroups: false
  ```
  Expected output: Adds repo without group support (`changed: true`).
- **exclude**:
  - description: Specifies a space-separated list of packages to exclude from installation or updates from this repository, overriding global excludes.
  - Type: list / elements=string. Default: None.
  - Possible values: Package names/globs (e.g., ["kernel*", "debug*"] effect: skips listed packages).
  - Required: No.
  - Notes: Overrides yum.conf excludes for this repo.
  Unique example: Exclude debug packages.
  ```yaml
  - name: Add repo excluding debug
    ansible.builtin.yum_repository:
      name: clean_repo
      description: Clean Repo
      baseurl: http://clean.repo/fedora/39/
      exclude: ["debug*", "test*"]
  ```
  Expected output: Adds repo with exclusions (`changed: true`).
- **failovermethod**:
  - description: Defines the method for handling multiple baseurl mirrors, determining how yum switches between them if one fails.
  - Type: string. Default: "roundrobin".
  - Possible values: "roundrobin" (effect: cycles through mirrors), "priority" (effect: uses highest priority first).
  - Required: No.
  - Notes: Requires multiple baseurls.
  Unique example: Use priority failover.
  ```yaml
  - name: Add repo with priority failover
    ansible.builtin.yum_repository:
      name: prio_repo
      description: Priority Failover Repo
      baseurl:
        - http://primary.repo/centos/8/
        - http://backup.repo/centos/8/
      failovermethod: priority
  ```
  Expected output: Adds repo with priority failover (`changed: true`).
- **file**:
  - description: Specifies the name of the .repo file where this repository definition should be stored, allowing multiple repos in one file.
  - Type: string. Default: <repo_name>.repo.
  - Possible values: Any filename (e.g., "custom_repos.repo" effect: stores in that file).
  - Required: No.
  - Notes: Overrides default naming.
  Unique example: Store in custom file.
  ```yaml
  - name: Add repo to custom file
    ansible.builtin.yum_repository:
      name: custom_repo
      description: Custom File Repo
      baseurl: http://custom.repo/rhel/9/
      file: my_custom_repos.repo
  ```
  Expected output: Adds to my_custom_repos.repo (`changed: true`).
- **gpgcheck**:
  - description: Enables or disables GPG signature checking for packages from this repository, ensuring authenticity and integrity.
  - Type: boolean. Default: false.
  - Possible values: true (effect: verifies signatures with `gpgkey`, secure but fails on unsigned), false (effect: skips checks, risky but allows unsigned).
  - Required: No.
  - Notes: Requires `gpgkey` if true.
  Unique example: Enable GPG check.
  ```yaml
  - name: Add repo with GPG
    ansible.builtin.yum_repository:
      name: secure_repo
      description: Secure Repo
      baseurl: http://secure.repo/centos/7/
      gpgcheck: true
      gpgkey: http://secure.repo/RPM-GPG-KEY
  ```
  Expected output: Adds repo with GPG verification (`changed: true`).
- **gpgkey**:
  - description: Specifies the URL or local path to the GPG key used to sign packages, required when `gpgcheck` is true.
  - Type: list / elements=string. Default: None.
  - Possible values: URLs/paths (e.g., ["http://key.example.com/RPM-GPG-KEY"] effect: imports key).
  - Required: No (but required if `gpgcheck: true`).
  - Notes: Supports multiple keys.
  Unique example: Use local GPG key.
  ```yaml
  - name: Add repo with local key
    ansible.builtin.yum_repository:
      name: local_key_repo
      description: Local Key Repo
      baseurl: http://local.repo/fedora/40/
      gpgcheck: true
      gpgkey: file:///etc/pki/rpm-gpg/RPM-GPG-KEY-local
  ```
  Expected output: Adds repo with local key (`changed: true`).
- **http_caching**:
  - description: Controls how HTTP content is cached by yum, affecting performance and disk usage for repository access.
  - Type: string. Default: "all".
  - Possible values: "all" (effect: caches everything), "packages" (effect: caches only packages), "none" (effect: no caching).
  - Required: No.
  - Notes: Impacts speed vs. storage.
  Unique example: Cache only packages.
  ```yaml
  - name: Add repo with package caching
    ansible.builtin.yum_repository:
      name: pkg_cache_repo
      description: Package Cache Repo
      baseurl: http://pkg.repo/rhel/8/
      http_caching: packages
  ```
  Expected output: Adds repo with package-only cache (`changed: true`).
- **include**:
  - description: Specifies an additional configuration file to include in this repository definition, extending its settings.
  - Type: list / elements=string. Default: None.
  - Possible values: File paths (e.g., ["/etc/yum/custom.conf"] effect: includes extra config).
  - Required: No.
  - Notes: Rarely used; must exist.
  Unique example: Include extra config.
  ```yaml
  - name: Add repo with include
    ansible.builtin.yum_repository:
      name: extra_config_repo
      description: Extra Config Repo
      baseurl: http://extra.repo/centos/7/
      include: ["/etc/yum/extra.conf"]
  ```
  Expected output: Adds repo with included config (`changed: true`).
- **includepkgs**:
  - description: Limits the packages included from this repository to the specified list, excluding others even if available.
  - Type: list / elements=string. Default: None.
  - Possible values: Package names (e.g., ["httpd", "nginx"] effect: only these are considered).
  - Required: No.
  - Notes: Complements `exclude`.
  Unique example: Include specific packages.
  ```yaml
  - name: Add repo with included pkgs
    ansible.builtin.yum_repository:
      name: selective_repo
      description: Selective Repo
      baseurl: http://selective.repo/fedora/39/
      includepkgs: ["httpd", "mariadb"]
  ```
  Expected output: Adds repo with limited packages (`changed: true`).
- **keepalive**:
  - description: Enables or disables persistent HTTP connections to the repository server, improving performance for multiple requests.
  - Type: boolean. Default: true.
  - Possible values: true (effect: keeps connection alive), false (effect: closes after each request).
  - Required: No.
  - Notes: Affects network efficiency.
  Unique example: Disable keepalive.
  ```yaml
  - name: Add repo without keepalive
    ansible.builtin.yum_repository:
      name: no_keepalive_repo
      description: No Keepalive Repo
      baseurl: http://nokeepalive.repo/rhel/9/
      keepalive: false
  ```
  Expected output: Adds repo without persistent connections (`changed: true`).
- **metadata_expire**:
  - description: Sets the time (in seconds) after which repository metadata is considered expired and must be refreshed, controlling update frequency.
  - Type: string. Default: "21600" (6 hours).
  - Possible values: Numeric string (e.g., "86400" effect: 24 hours, "never" effect: no expiration).
  - Required: No.
  - Notes: Impacts cache refresh.
  Unique example: Set long metadata expire.
  ```yaml
  - name: Add repo with long expire
    ansible.builtin.yum_repository:
      name: long_expire_repo
      description: Long Expire Repo
      baseurl: http://longexpire.repo/centos/8/
      metadata_expire: "172800"
  ```
  Expected output: Adds repo with 48-hour expire (`changed: true`).
- **mirrorlist**:
  - description: Specifies a URL providing a list of mirrors for the repository, overriding `baseurl` if both are present.
  - Type: string. Default: None.
  - Possible values: URL (e.g., "http://mirrors.example.com/mirrors.txt" effect: uses mirror list).
  - Required: No.
  - Notes: Preferred for dynamic mirroring.
  Unique example: Use mirrorlist.
  ```yaml
  - name: Add repo with mirrorlist
    ansible.builtin.yum_repository:
      name: mirror_repo
      description: Mirror Repo
      mirrorlist: http://mirrors.custom.com/fedora/40/mirrors
  ```
  Expected output: Adds repo with mirrorlist (`changed: true`).
- **name**:
  - description: Defines the unique identifier for the repository within the .repo file, used to reference it in yum operations.
  - Type: string. Default: None.
  - Possible values: Any string (e.g., "myrepo" effect: identifies the repo).
  - Required: Yes.
  - Notes: Must be unique per file.
  Unique example: Unique repo name.
  ```yaml
  - name: Add uniquely named repo
    ansible.builtin.yum_repository:
      name: my_unique_repo
      description: Unique Repo
      baseurl: http://unique.repo/rhel/9/
  ```
  Expected output: Adds repo with unique ID (`changed: true`).
- **password**:
  - description: Provides the password for repositories requiring authentication, used with `username` for secure access.
  - Type: string. Default: None.
  - Possible values: Any string (effect: authenticates access).
  - Required: No.
  - Notes: Store securely (e.g., vault).
  Unique example: Add authenticated repo.
  ```yaml
  - name: Add password-protected repo
    ansible.builtin.yum_repository:
      name: auth_repo
      description: Auth Repo
      baseurl: http://auth.repo/centos/7/
      username: user1
      password: securepass
  ```
  Expected output: Adds authenticated repo (`changed: true`).
- **priority**:
  - description: Assigns a priority level to the repository, with lower numbers taking precedence in package selection (requires `priority` plugin).
  - Type: string. Default: None.
  - Possible values: Numeric string (e.g., "10" effect: high priority, "50" effect: lower).
  - Required: No.
  - Notes: Needs plugin installation.
  Unique example: Set high priority.
  ```yaml
  - name: Add high-priority repo
    ansible.builtin.yum_repository:
      name: high_prio_repo
      description: High Priority Repo
      baseurl: http://highprio.repo/fedora/39/
      priority: "10"
  ```
  Expected output: Adds repo with high priority (`changed: true`).
- **proxy**:
  - description: Specifies a proxy server for accessing the repository, required for systems behind a firewall or proxy network.
  - Type: string. Default: None.
  - Possible values: URL (e.g., "http://proxy.example.com:8080" effect: routes through proxy).
  - Required: No.
  - Notes: Supports `proxy_username`/`proxy_password`.
  Unique example: Use proxy for repo.
  ```yaml
  - name: Add repo via proxy
    ansible.builtin.yum_repository:
      name: proxy_repo
      description: Proxy Repo
      baseurl: http://proxy.repo/rhel/8/
      proxy: http://proxy.company.com:3128
  ```
  Expected output: Adds repo with proxy (`changed: true`).
- **proxy_password**:
  - description: Provides the password for proxy authentication, used with `proxy_username` when a proxy requires credentials.
  - Type: string. Default: None.
  - Possible values: Any string (effect: authenticates proxy).
  - Required: No.
  - Notes: Secure with vault.
  Unique example: Add repo with proxy password.
  ```yaml
  - name: Add repo with proxy auth
    ansible.builtin.yum_repository:
      name: proxy_auth_repo
      description: Proxy Auth Repo
      baseurl: http://proxyauth.repo/centos/7/
      proxy: http://proxy.company.com:3128
      proxy_username: proxyuser
      proxy_password: proxypass
  ```
  Expected output: Adds repo with proxy auth (`changed: true`).
- **proxy_username**:
  - description: Specifies the username for proxy authentication, paired with `proxy_password` for secure proxy access.
  - Type: string. Default: None.
  - Possible values: Any string (effect: authenticates proxy).
  - Required: No.
  - Notes: Requires `proxy`.
  Unique example: Add repo with proxy user.
  ```yaml
  - name: Add repo with proxy user
    ansible.builtin.yum_repository:
      name: proxy_user_repo
      description: Proxy User Repo
      baseurl: http://proxyuser.repo/fedora/40/
      proxy: http://proxy.company.com:3128
      proxy_username: proxyadmin
  ```
  Expected output: Adds repo with proxy user (`changed: true`).
- **repo_gpgcheck**:
  - description: Enables GPG checking specifically for the repository metadata, separate from package `gpgcheck`.
  - Type: boolean. Default: false.
  - Possible values: true (effect: verifies metadata signatures), false (effect: skips metadata checks).
  - Required: No.
  - Notes: Independent of `gpgcheck`.
  Unique example: Enable repo GPG check.
  ```yaml
  - name: Add repo with metadata GPG
    ansible.builtin.yum_repository:
      name: meta_gpg_repo
      description: Metadata GPG Repo
      baseurl: http://metagpg.repo/rhel/9/
      repo_gpgcheck: true
  ```
  Expected output: Adds repo with metadata check (`changed: true`).
- **retries**:
  - description: Sets the number of times yum should attempt to retrieve data from the repository before failing, improving reliability on unstable networks.
  - Type: string. Default: "10".
  - Possible values: Numeric string (e.g., "5" effect: tries 5 times, "0" effect: no retries).
  - Required: No.
  - Notes: Affects download resilience.
  Unique example: Limit retries to 3.
  ```yaml
  - name: Add repo with few retries
    ansible.builtin.yum_repository:
      name: retry_repo
      description: Retry Repo
      baseurl: http://retry.repo/centos/8/
      retries: "3"
  ```
  Expected output: Adds repo with 3 retries (`changed: true`).
- **skip_if_unavailable**:
  - description: Allows yum to proceed if the repository is unavailable, preventing failures due to temporary outages.
  - Type: boolean. Default: false.
  - Possible values: true (effect: skips unavailable repo), false (effect: fails if unreachable).
  - Required: No.
  - Notes: Useful for optional repos.
  Unique example: Skip unavailable repo.
  ```yaml
  - name: Add repo with skip
    ansible.builtin.yum_repository:
      name: optional_repo
      description: Optional Repo
      baseurl: http://optional.repo/fedora/39/
      skip_if_unavailable: true
  ```
  Expected output: Adds repo with skip option (`changed: true`).
- **sslCACert**:
  - description: Specifies the path to a CA certificate file for SSL verification of the repository URL, ensuring secure connections.
  - Type: string. Default: None.
  - Possible values: File path (e.g., "/etc/ssl/certs/ca.crt" effect: uses for verification).
  - Required: No.
  - Notes: Required for self-signed certs.
  Unique example: Use custom CA cert.
  ```yaml
  - name: Add repo with CA cert
    ansible.builtin.yum_repository:
      name: ssl_repo
      description: SSL Repo
      baseurl: https://ssl.repo/rhel/8/
      sslCACert: /etc/ssl/custom-ca.crt
  ```
  Expected output: Adds repo with CA cert (`changed: true`).
- **sslclientcert**:
  - description: Provides the path to a client certificate file for mutual SSL authentication with the repository server.
  - Type: string. Default: None.
  - Possible values: File path (effect: authenticates client).
  - Required: No.
  - Notes: Requires `sslclientkey`.
  Unique example: Use client cert.
  ```yaml
  - name: Add repo with client cert
    ansible.builtin.yum_repository:
      name: client_ssl_repo
      description: Client SSL Repo
      baseurl: https://client.repo/centos/7/
      sslclientcert: /etc/ssl/client.crt
  ```
  Expected output: Adds repo with client cert (`changed: true`).
- **sslclientkey**:
  - description: Specifies the path to the client key file, paired with `sslclientcert` for mutual SSL authentication.
  - Type: string. Default: None.
  - Possible values: File path (effect: authenticates client).
  - Required: No.
  - Notes: Requires `sslclientcert`.
  Unique example: Use client key.
  ```yaml
  - name: Add repo with client key
    ansible.builtin.yum_repository:
      name: client_key_repo
      description: Client Key Repo
      baseurl: https://clientkey.repo/fedora/40/
      sslclientkey: /etc/ssl/client.key
  ```
  Expected output: Adds repo with client key (`changed: true`).
- **sslverify**:
  - description: Controls whether SSL verification is performed for the repository URL, ensuring secure communication.
  - Type: boolean. Default: true.
  - Possible values: true (effect: verifies SSL, secure), false (effect: disables, allows self-signed but risky).
  - Required: No.
  - Notes: Affects HTTPS repos.
  Unique example: Disable SSL verify.
  ```yaml
  - name: Add repo without SSL verify
    ansible.builtin.yum_repository:
      name: no_ssl_repo
      description: No SSL Verify Repo
      baseurl: https://nossl.repo/rhel/9/
      sslverify: false
  ```
  Expected output: Adds repo without SSL check (`changed: true`).
- **state**:
  - description: Defines the desired state of the repository, controlling whether it is added or removed.
  - Type: string. Default: present.
  - Possible values: present (effect: ensures repo exists), absent (effect: removes repo and file if empty).
  - Required: No.
  - Notes: Triggers cleanup if absent.
  Unique example: Remove unused repo.
  ```yaml
  - name: Remove unused repo
    ansible.builtin.yum_repository:
      name: old_repo
      state: absent
  ```
  Expected output: Removes repo (`changed: true`); may delete file.
- **throttle**:
  - description: Limits the download rate from this repository, either as a percentage of bandwidth or a fixed rate, managing network load.
  - Type: string. Default: "" (no throttling).
  - Possible values: Percentage (e.g., "50%" effect: 50% of bandwidth), rate (e.g., "500k" effect: 500KB/s).
  - Required: No.
  - Notes: Uses `bandwidth` if percentage.
  Unique example: Throttle to 200KB/s.
  ```yaml
  - name: Add repo with throttle
    ansible.builtin.yum_repository:
      name: throttled_repo
      description: Throttled Repo
      baseurl: http://throttle.repo/centos/8/
      throttle: "200k"
  ```
  Expected output: Adds repo with 200KB/s limit (`changed: true`).
- **timeout**:
  - description: Sets the connection timeout in seconds for accessing the repository, preventing hangs on slow networks.
  - Type: string. Default: "30".
  - Possible values: Numeric string (e.g., "10" effect: 10 seconds, "60" effect: 1 minute).
  - Required: No.
  - Notes: Affects download reliability.
  Unique example: Set short timeout.
  ```yaml
  - name: Add repo with short timeout
    ansible.builtin.yum_repository:
      name: quick_repo
      description: Quick Timeout Repo
      baseurl: http://quick.repo/fedora/39/
      timeout: "15"
  ```
  Expected output: Adds repo with 15s timeout (`changed: true`).
- **username**:
  - description: Specifies the username for repository authentication, used with `password` for secure access.
  - Type: string. Default: None.
  - Possible values: Any string (effect: authenticates access).
  - Required: No.
  - Notes: Requires `password`.
  Unique example: Add repo with username.
  ```yaml
  - name: Add repo with user auth
    ansible.builtin.yum_repository:
      name: user_repo
      description: User Auth Repo
      baseurl: http://user.repo/rhel/9/
      username: repo_user
      password: userpass
  ```
  Expected output: Adds authenticated repo (`changed: true`).
#### Practical Examples and Expected Outcomes
1. **Add Repository with Unique Configuration**:
   ```yaml
   - name: Add custom secure repo
     ansible.builtin.yum_repository:
       name: custom_secure
       description: Custom Secure Repository
       baseurl: http://customsecure.repo/rhel/9/
       gpgcheck: true
       gpgkey: http://customsecure.repo/RPM-GPG-KEY-custom
       state: present
   ```
   Expected output: Adds repo with GPG (`changed: true`); verifies packages.
2. **Remove Repository with Cleanup**:
   ```yaml
   - name: Remove unused repo with cleanup
     ansible.builtin.yum_repository:
       name: unused_repo
       state: absent
     notify: yum-clean-metadata
   - name: yum-clean-metadata
     ansible.builtin.command: yum clean metadata
     listen: yum-clean-metadata
   ```
   Expected output: Removes repo and cleans cache (`changed: true` for both).

## Additional Examples for the Ansible Yum Repository Module

#### Example 1: Adding a Repository with Multiple Baseurl Mirrors and GPG Check
```yaml
- name: Add repository with multiple mirrors and GPG verification
  ansible.builtin.yum_repository:
    name: multi_mirror_repo
    description: Multi-Mirror Repository with GPG Verification
    baseurl:
      - http://mirror1.example.com/centos/8/
      - http://mirror2.example.com/centos/8/
      - http://mirror3.example.com/centos/8/
    gpgcheck: true
    gpgkey: http://mirror1.example.com/RPM-GPG-KEY-centos8
    enabled: true
    state: present
```
**Explanation**: This example creates a repository with three mirror URLs for redundancy. GPG verification is enabled to ensure package authenticity, and the GPG key is fetched from the first mirror. The repository is enabled by default. Output shows `changed: true` if the repository was added or modified.

#### Example 2: Adding a Repository with Mirrorlist and Priority
```yaml
- name: Add repository with mirrorlist and high priority
  ansible.builtin.yum_repository:
    name: high_priority_repo
    description: High Priority Repository
    mirrorlist: http://mirrors.example.com/mirrorlist?repo=centos8
    priority: "10"
    gpgcheck: true
    gpgkey: file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centos8
    state: present
```
**Explanation**: This example uses a mirrorlist URL that dynamically provides mirror locations. The repository is set with high priority (10) so it's preferred over others with higher numbers. GPG verification is enabled with a local key file. Output shows `changed: true` if the repository was added.

#### Example 3: Adding a Repository with SSL Client Certificate Authentication
```yaml
- name: Add repository with SSL client certificate authentication
  ansible.builtin.yum_repository:
    name: ssl_auth_repo
    description: SSL Authenticated Repository
    baseurl: https://secure.example.com/centos/8/
    sslclientcert: /etc/ssl/certs/client.crt
    sslclientkey: /etc/ssl/private/client.key
    sslverify: true
    gpgcheck: true
    state: present
```
**Explanation**: This example configures a repository that requires SSL client certificate authentication. Both the client certificate and private key are specified, and SSL verification is enabled. GPG checks are also enabled for additional security. Output shows `changed: true` if the repository was added.

#### Example 4: Adding a Repository with Proxy Settings
```yaml
- name: Add repository with proxy authentication
  ansible.builtin.yum_repository:
    name: proxy_repo
    description: Repository via Proxy
    baseurl: http://external.example.com/centos/8/
    proxy: http://proxy.company.com:3128
    proxy_username: proxyuser
    proxy_password: proxypass
    gpgcheck: false
    state: present
```
**Explanation**: This example configures a repository accessed through a proxy server that requires authentication. The proxy URL, username, and password are specified. GPG checks are disabled (common for internal repositories). Output shows `changed: true` if the repository was added.

#### Example 5: Adding a Repository with Bandwidth Throttling
```yaml
- name: Add repository with bandwidth throttling
  ansible.builtin.yum_repository:
    name: throttled_repo
    description: Bandwidth Throttled Repository
    baseurl: http://throttled.example.com/centos/8/
    throttle: "500k"
    bandwidth: "1048576"
    gpgcheck: true
    state: present
```
**Explanation**: This example limits the download rate from the repository to 500KB/s. The bandwidth parameter is set to 1MB/s, but throttle takes precedence when specified as a rate. GPG verification is enabled. Output shows `changed: true` if the repository was added.

#### Example 6: Adding a Repository with Custom Metadata Expiration
```yaml
- name: Add repository with long metadata expiration
  ansible.builtin.yum_repository:
    name: long_expire_repo
    description: Long Metadata Expiration Repository
    baseurl: http://longexpire.example.com/centos/8/
    metadata_expire: "604800"  # 7 days
    gpgcheck: true
    state: present
```
**Explanation**: This example sets the metadata expiration to 7 days (604800 seconds), meaning yum won't refresh the repository metadata for a week. This is useful for stable repositories that don't change often. Output shows `changed: true` if the repository was added.

#### Example 7: Adding a Repository with Exclude Patterns
```yaml
- name: Add repository with exclude patterns
  ansible.builtin.yum_repository:
    name: exclude_repo
    description: Repository with Excludes
    baseurl: http://exclude.example.com/centos/8/
    exclude:
      - kernel*
      - debuginfo*
      - test*
    gpgcheck: true
    state: present
```
**Explanation**: This example excludes packages matching the patterns "kernel*", "debuginfo*", and "test*" from being installed or updated from this repository. This is useful for preventing certain types of packages from being considered. Output shows `changed: true` if the repository was added.

#### Example 8: Adding a Repository with Include Packages
```yaml
- name: Add repository with include packages only
  ansible.builtin.yum_repository:
    name: include_only_repo
    description: Include-Only Repository
    baseurl: http://include.example.com/centos/8/
    includepkgs:
      - httpd
      - nginx
      - php
    gpgcheck: true
    state: present
```
**Explanation**: This example restricts the repository to only consider the packages "httpd", "nginx", and "php". All other packages in the repository will be ignored. This is useful for creating specialized repositories. Output shows `changed: true` if the repository was added.

#### Example 9: Adding a Repository with Failover Method
```yaml
- name: Add repository with priority failover
  ansible.builtin.yum_repository:
    name: failover_repo
    description: Priority Failover Repository
    baseurl:
      - http://primary.example.com/centos/8/
      - http://backup.example.com/centos/8/
    failovermethod: priority
    gpgcheck: true
    state: present
```
**Explanation**: This example configures a repository with two base URLs and sets the failover method to "priority", meaning yum will try the primary mirror first and only use the backup if the primary fails. Output shows `changed: true` if the repository was added.

#### Example 10: Adding a Repository with Retry and Timeout Settings
```yaml
- name: Add repository with retry and timeout settings
  ansible.builtin.yum_repository:
    name: resilient_repo
    description: Resilient Repository
    baseurl: http://resilient.example.com/centos/8/
    retries: "5"
    timeout: "60"
    gpgcheck: true
    state: present
```
**Explanation**: This example sets the repository to retry downloads up to 5 times before giving up and sets a 60-second timeout for connections. This improves reliability on unstable networks. Output shows `changed: true` if the repository was added.

#### Example 11: Adding a Repository with Skip If Unavailable
```yaml
- name: Add repository that skips if unavailable
  ansible.builtin.yum_repository:
    name: optional_repo
    description: Optional Repository
    baseurl: http://optional.example.com/centos/8/
    skip_if_unavailable: true
    gpgcheck: true
    state: present
```
**Explanation**: This example configures the repository so that yum will skip it if it's unavailable, rather than failing the entire operation. This is useful for optional repositories that might not always be accessible. Output shows `changed: true` if the repository was added.

#### Example 12: Adding a Repository with SSL Verification Disabled
```yaml
- name: Add repository with SSL verification disabled
  ansible.builtin.yum_repository:
    name: no_ssl_verify_repo
    description: No SSL Verify Repository
    baseurl: https://selfsigned.example.com/centos/8/
    sslverify: false
    gpgcheck: true
    state: present
```
**Explanation**: This example disables SSL verification for the repository, which is necessary when using self-signed certificates that aren't trusted by the system. GPG checks are still enabled for package verification. Output shows `changed: true` if the repository was added.

#### Example 13: Adding a Repository with Package-Only Caching
```yaml
- name: Add repository with package-only caching
  ansible.builtin.yum_repository:
    name: pkg_cache_repo
    description: Package-Only Cache Repository
    baseurl: http://pkgcache.example.com/centos/8/
    http_caching: packages
    gpgcheck: true
    state: present
```
**Explanation**: This example sets HTTP caching to only cache packages, not metadata. This reduces disk usage while still keeping package files cached for faster installation. Output shows `changed: true` if the repository was added.

#### Example 14: Adding a Repository with Keepalive Disabled
```yaml
- name: Add repository with keepalive disabled
  ansible.builtin.yum_repository:
    name: no_keepalive_repo
    description: No Keepalive Repository
    baseurl: http://nokeepalive.example.com/centos/8/
    keepalive: false
    gpgcheck: true
    state: present
```
**Explanation**: This example disables HTTP keepalive for the repository, meaning each request will open a new connection. This can be useful for troubleshooting connection issues or when working with servers that don't handle persistent connections well. Output shows `changed: true` if the repository was added.

#### Example 15: Removing a Repository and Cleaning Up
```yaml
- name: Remove repository and clean up
  ansible.builtin.yum_repository:
    name: old_repo
    state: absent
  notify: Clean yum cache

- name: Clean yum cache
  ansible.builtin.command: yum clean all
  listen: Clean yum cache
```
**Explanation**: This example removes a repository definition and then cleans the yum cache to remove any cached metadata from the removed repository. The cleanup is triggered via a handler to ensure it only runs when the repository is actually removed. Output shows `changed: true` for both the repository removal and cache cleaning.

### Summary Table of Arguments
| Argument Name    | Type               | Default Value       | Possible Values and Effects                              | Required | Notes/Deprecations                       |
|-------------------|---------------------|---------------------|----------------------------------------------------------|----------|------------------------------------------|
| async            | boolean            | true (2.11-2.13), null | true (parallel), false (sequential), null (avoid)        | No       | Deprecated; removed 2.22                 |
| attributes (attr) | string             | None                | chattr strings (e.g., '+i' immutable)                    | No       | -                                         |
| bandwidth        | string             | "0"                 | Numeric (e.g., "1048576" for 1MB/s, "0" disables)        | No       | With throttle                             |
| baseurl          | list / elements=string | None          | URL/list (defines repodata source)                       | No       | Replaces mirrorlist                       |
| cost             | string             | "1000"              | Numeric (e.g., "500" prioritizes)                        | No       | With priority plugin                      |
| description      | string             | None                | Any string (labels repo)                                 | No       | Comments removed                          |
| enabled          | boolean            | true                | true (active), false (disabled)                          | No       | -                                         |
| enablegroups     | boolean            | true                | true (allows groups), false (disables)                   | No       | -                                         |
| exclude          | list / elements=string | None          | Names/globs (excludes packages)                          | No       | Overrides global excludes                 |
| failovermethod   | string             | "roundrobin"        | "roundrobin" (cycles), "priority" (highest first)        | No       | Requires multiple baseurls                |
| file             | string             | <repo_name>.repo    | Any filename (stores definition)                         | No       | -                                         |
| gpgcheck         | boolean            | false               | true (verifies signatures), false (skips)                | No       | Requires gpgkey                           |
| gpgkey           | list / elements=string | None          | URLs/paths (imports keys)                                | No       | Required if gpgcheck true                 |
| http_caching     | string             | "all"               | "all" (caches all), "packages" (packages only), "none"   | No       | -                                         |
| include          | list / elements=string | None          | File paths (includes extra config)                       | No       | Must exist                                |
| includepkgs      | list / elements=string | None          | Names (limits included packages)                         | No       | -                                         |
| keepalive        | boolean            | true                | true (persistent), false (closes)                        | No       | -                                         |
| metadata_expire  | string             | "21600"             | Numeric (e.g., "86400" for 24h), "never" (no expire)     | No       | -                                         |
| mirrorlist       | string             | None                | URL (provides mirror list)                               | No       | Overrides baseurl                         |
| name             | string             | None                | Any string (identifies repo)                             | Yes      | Must be unique                            |
| password         | string             | None                | Any string (authenticates)                               | No       | Secure with vault                         |
| priority         | string             | None                | Numeric (e.g., "10" high, "50" low)                      | No       | Requires plugin                           |
| proxy            | string             | None                | URL (routes through proxy)                               | No       | Supports auth                             |
| proxy_password   | string             | None                | Any string (proxy auth)                                  | No       | Secure with vault                         |
| proxy_username   | string             | None                | Any string (proxy auth)                                  | No       | Requires proxy                            |
| repo_gpgcheck    | boolean            | false               | true (verifies metadata), false (skips)                  | No       | -                                         |
| retries          | string             | "10"                | Numeric (e.g., "5" tries, "0" no retry)                  | No       | -                                         |
| skip_if_unavailable | boolean       | false               | true (skips unavailable), false (fails)                  | No       | -                                         |
| sslCACert        | string             | None                | File path (CA certificate)                               | No       | For self-signed certs                     |
| sslclientcert    | string             | None                | File path (client certificate)                           | No       | Requires sslclientkey                     |
| sslclientkey     | string             | None                | File path (client key)                                   | No       | Requires sslclientcert                    |
| sslverify        | boolean            | true                | true (verifies SSL), false (disables)                    | No       | -                                         |
| state            | string             | present             | present (adds), absent (removes)                         | No       | -                                         |
| throttle         | string             | ""                  | Percentage (e.g., "50%"), rate (e.g., "500k")            | No       | Uses bandwidth if percentage              |
| timeout          | string             | "30"                | Numeric (e.g., "10" for 10s, "60" for 1m)                | No       | -                                         |
| username         | string             | None                | Any string (authenticates)                               | No       | Requires password                         |
